



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Everything which I have to write down to remember it">
      
      
      
        <meta name="author" content="Philip Henning">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>ZNC - Philip's docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../../#znc" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Philip's docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Philip's docs
              </span>
              <span class="md-header-nav__topic">
                ZNC
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/shokinn/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      shokinn/docs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Philip's docs" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    Philip's docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/shokinn/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      shokinn/docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Hardware
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Hardware
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Dell XPS 15 9560
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Dell XPS 15 9560
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../hardware/dell_xps_15_9560/dell_xps_15_9560_arch_linux/" title="Arch Linux" class="md-nav__link">
      Arch Linux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Desktop
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Desktop
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../desktop/playonlinux/" title="PlayOnLinux" class="md-nav__link">
      PlayOnLinux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../concourse_dockerized/" title="Concourse Dockerized" class="md-nav__link">
      Concourse Dockerized
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quassel/" title="Quassel" class="md-nav__link">
      Quassel
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Knowledge base
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Knowledge base
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kb/change_tty/" title="How to change to TTYn" class="md-nav__link">
      How to change to TTYn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kb/mkdocs/" title="MkDocs testing environment" class="md-nav__link">
      MkDocs testing environment
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../imprint/" title="Impressum" class="md-nav__link">
      Impressum
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../datenschutzerklaerung/" title="Datenschutzerklärung" class="md-nav__link">
      Datenschutzerklärung
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-server-setup" title="Initial Server setup" class="md-nav__link">
    Initial Server setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-system" title="Update System" class="md-nav__link">
    Update System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-vim-colored-with-dark-background-settings" title="Make vim colored with dark background settings" class="md-nav__link">
    Make vim colored with dark background settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-locale" title="Fix locale" class="md-nav__link">
    Fix locale
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edit-bashrc" title="Edit .bashrc" class="md-nav__link">
    Edit .bashrc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-user-user" title="Create a new user user" class="md-nav__link">
    Create a new user user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-the-ssh-deamon-to-allow-only-ssh-keys" title="Change the SSH deamon to allow only SSH-keys" class="md-nav__link">
    Change the SSH deamon to allow only SSH-keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-roots-authorized_keys-file" title="Delete root's authorized_keys file" class="md-nav__link">
    Delete root's authorized_keys file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-base-packages" title="Install base packages" class="md-nav__link">
    Install base packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-znc" title="Install ZNC" class="md-nav__link">
    Install ZNC
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-requiemetns" title="Pre-requiemetns" class="md-nav__link">
    Pre-requiemetns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-znc_1" title="Install ZNC" class="md-nav__link">
    Install ZNC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-znc" title="Configure ZNC" class="md-nav__link">
    Configure ZNC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#znc-service" title="ZNC service" class="md-nav__link">
    ZNC service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx" title="Nginx" class="md-nav__link">
    Nginx
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure" title="Configure" class="md-nav__link">
    Configure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-default-entry" title="Delete default entry" class="md-nav__link">
    Delete default entry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-ssl_params" title="Add ssl_params" class="md-nav__link">
    Add ssl_params
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-http-to-https-redirector" title="General HTTP to HTTPS redirector" class="md-nav__link">
    General HTTP to HTTPS redirector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#znc-web-interface-on-port-443" title="ZNC web interface on Port 443" class="md-nav__link">
    ZNC web interface on Port 443
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-cronjob-for-renewing-cetificates" title="Add cronjob for renewing cetificates" class="md-nav__link">
    Add cronjob for renewing cetificates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#znc-ssl-config" title="ZNC SSL config" class="md-nav__link">
    ZNC SSL config
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-copy-of-our-lets-encrypt-certificates-to-znc" title="Initial copy of our let's encrypt certificates to znc" class="md-nav__link">
    Initial copy of our let's encrypt certificates to znc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-znc-for-the-1st-time" title="Run ZNC for the 1st time" class="md-nav__link">
    Run ZNC for the 1st time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/shokinn/docs/edit/master/docs/software/server/znc_irc_bouncer.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="znc">ZNC<a class="headerlink" href="#znc" title="Permanent link">&para;</a></h1>
<p>ZNC is an advanced IRC bouncer that is left connected so an IRC client can disconnect/reconnect without losing the chat session.</p>
<p>OS: Ubuntu 18.04 LTS (Bionic Beaver)</p>
<h2 id="initial-server-setup">Initial Server setup<a class="headerlink" href="#initial-server-setup" title="Permanent link">&para;</a></h2>
<h3 id="update-system">Update System<a class="headerlink" href="#update-system" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>apt update <span class="o">&amp;&amp;</span> apt full-upgrade -y <span class="o">&amp;&amp;</span> <span class="se">\</span>
apt autoremove -y
</pre></div>
</td></tr></table>

<h3 id="make-vim-colored-with-dark-background-settings">Make vim colored with dark background settings<a class="headerlink" href="#make-vim-colored-with-dark-background-settings" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF &gt;&gt; /etc/vim/vimrc</span>

<span class="s">&quot; Set background to dark for better readability in SSH connections</span>
<span class="s">set background=dark</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>

<h3 id="fix-locale">Fix locale<a class="headerlink" href="#fix-locale" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sudo tee -a /etc/environment</span>

<span class="s"># Fix locale</span>
<span class="s">LC_ALL=en_US.UTF-8</span>
<span class="s">LANGUAGE=en_US:en</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>

<h3 id="edit-bashrc">Edit .bashrc<a class="headerlink" href="#edit-bashrc" title="Permanent link">&para;</a></h3>
<p><code>/root/.bashrc</code> / <code>/etc/skel/.bashrc</code>:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104</pre></div></td><td class="code"><div class="codehilite"><pre><span></span># ~/.bashrc: executed by bash(1) for non-login shells.
# see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)
# for examples

# If not running interactively, don&#39;t do anything
[ -z &quot;$PS1&quot; ] &amp;&amp; return

# don&#39;t put duplicate lines in the history. See bash(1) for more options
# ... or force ignoredups and ignorespace
HISTCONTROL=ignoredups:ignorespace

# append to the history file, don&#39;t overwrite it
shopt -s histappend

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
HISTSIZE=999999
HISTFILESIZE=999999

# check the window size after each command and, if necessary,
# update the values of LINES and COLUMNS.
shopt -s checkwinsize

# make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] &amp;&amp; eval &quot;$(SHELL=/bin/sh lesspipe)&quot;

# set variable identifying the chroot you work in (used in the prompt below)
if [ -z &quot;$debian_chroot&quot; ] &amp;&amp; [ -r /etc/debian_chroot ]; then
    debian_chroot=$(cat /etc/debian_chroot)
fi

# set a fancy prompt (non-color, unless we know we &quot;want&quot; color)
case &quot;$TERM&quot; in
    xterm-color) color_prompt=yes;;
esac

# uncomment for a colored prompt, if the terminal has the capability; turned
# off by default to not distract the user: the focus in a terminal window
# should be on the output of commands, not on the prompt
force_color_prompt=yes

if [ -n &quot;$force_color_prompt&quot; ]; then
    if [ -x /usr/bin/tput ] &amp;&amp; tput setaf 1 &gt;&amp;/dev/null; then
    # We have color support; assume it&#39;s compliant with Ecma-48
    # (ISO/IEC-6429). (Lack of such support is extremely rare, and such
    # a case would tend to support setf rather than setaf.)
    color_prompt=yes
    else
    color_prompt=
    fi
fi

if [ &quot;$color_prompt&quot; = yes ]; then
    # PS1=&#39;${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ &#39;
    if [ $UID == 0 ]; then
        PS1=&#39;${debian_chroot:+($debian_chroot)}\[\033[01;31m\]\u\[\033[01;33m\]@\[\033[01;36m\]\h \[\033[01;33m\]\w \[\033[01;35m\]\$ \[\033[00m\]&#39;
    else
        PS1=&#39;${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u\[\033[01;33m\]@\[\033[01;36m\]\h \[\033[01;33m\]\w \[\033[01;35m\]\$ \[\033[00m\]&#39;
    fi
else
    PS1=&#39;${debian_chroot:+($debian_chroot)}\u@\h:\w\$ &#39;
fi
unset color_prompt force_color_prompt

# If this is an xterm set the title to user@host:dir
case &quot;$TERM&quot; in
xterm*|rxvt*)
    PS1=&quot;\[\e]0;${debian_chroot:+($debian_chroot)}\u@\h: \w\a\]$PS1&quot;
    ;;
*)
    ;;
esac

# enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors &amp;&amp; eval &quot;$(dircolors -b ~/.dircolors)&quot; || eval &quot;$(dircolors -b)&quot;
    alias ls=&#39;ls --color=auto&#39;
    #alias dir=&#39;dir --color=auto&#39;
    #alias vdir=&#39;vdir --color=auto&#39;

    alias grep=&#39;grep --color=auto&#39;
    alias fgrep=&#39;fgrep --color=auto&#39;
    alias egrep=&#39;egrep --color=auto&#39;
fi

# some more ls aliases
alias ll=&#39;ls -alF&#39;
alias la=&#39;ls -A&#39;
alias l=&#39;ls -CF&#39;

# Alias definitions.
# You may want to put all your additions into a separate file like
# ~/.bash_aliases, instead of adding them here directly.
# See /usr/share/doc/bash-doc/examples in the bash-doc package.

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

# enable programmable completion features (you don&#39;t need to enable
# this, if it&#39;s already enabled in /etc/bash.bashrc and /etc/profile
# sources /etc/bash.bashrc).
#if [ -f /etc/bash_completion ] &amp;&amp; ! shopt -oq posix; then
#    . /etc/bash_completion
#fi
</pre></div>
</td></tr></table></p>
<h3 id="create-a-new-user-user">Create a new user <code>user</code><a class="headerlink" href="#create-a-new-user-user" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>adduser user <span class="o">&amp;&amp;</span> <span class="se">\</span>
usermod -aG sudo user <span class="o">&amp;&amp;</span> <span class="se">\</span>
mkdir /home/user/.ssh <span class="o">&amp;&amp;</span> <span class="se">\</span>
chmod <span class="m">700</span> /home/user/.ssh <span class="o">&amp;&amp;</span> <span class="se">\</span>
cp /root/.ssh/authorized_keys /home/user/.ssh/ <span class="o">&amp;&amp;</span> <span class="se">\</span>
chmod <span class="m">400</span> /home/user/.ssh/authorized_keys <span class="o">&amp;&amp;</span> <span class="se">\</span>
chown -R user:user /home/user/.ssh/
</pre></div>
</td></tr></table>

<h3 id="change-the-ssh-deamon-to-allow-only-ssh-keys">Change the SSH deamon to allow only SSH-keys<a class="headerlink" href="#change-the-ssh-deamon-to-allow-only-ssh-keys" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF &gt; /etc/ssh/sshd_config &amp;&amp; systemctl restart sshd.service</span>
<span class="s">#   $OpenBSD: sshd_config,v 1.101 2017/03/14 07:19:07 djm Exp $</span>

<span class="s"># This is the sshd server system-wide configuration file.  See</span>
<span class="s"># sshd_config(5) for more information.</span>

<span class="s"># This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin</span>

<span class="s"># The strategy used for options in the default sshd_config shipped with</span>
<span class="s"># OpenSSH is to specify options with their default value where</span>
<span class="s"># possible, but leave them commented.  Uncommented options override the</span>
<span class="s"># default value.</span>

<span class="s">Port 22</span>
<span class="s">AddressFamily any</span>
<span class="s">ListenAddress 0.0.0.0</span>
<span class="s">ListenAddress ::</span>

<span class="s">HostKey /etc/ssh/ssh_host_rsa_key</span>
<span class="s">HostKey /etc/ssh/ssh_host_ecdsa_key</span>
<span class="s">HostKey /etc/ssh/ssh_host_ed25519_key</span>

<span class="s"># Ciphers and keying</span>
<span class="s">#RekeyLimit default none</span>

<span class="s"># Logging</span>
<span class="s">#SyslogFacility AUTH</span>
<span class="s">#LogLevel INFO</span>

<span class="s"># Authentication:</span>

<span class="s">#LoginGraceTime 2m</span>
<span class="s">PermitRootLogin without-password</span>
<span class="s">#StrictModes yes</span>
<span class="s">#MaxAuthTries 6</span>
<span class="s">#MaxSessions 10</span>

<span class="s">PubkeyAuthentication yes</span>

<span class="s"># Expect .ssh/authorized_keys2 to be disregarded by default in future.</span>
<span class="s">AuthorizedKeysFile  .ssh/authorized_keys .ssh/authorized_keys2</span>

<span class="s">#AuthorizedPrincipalsFile none</span>

<span class="s">#AuthorizedKeysCommand none</span>
<span class="s">#AuthorizedKeysCommandUser nobody</span>

<span class="s"># For this to work you will also need host keys in /etc/ssh/ssh_known_hosts</span>
<span class="s">#HostbasedAuthentication no</span>
<span class="s"># Change to yes if you don&#39;t trust ~/.ssh/known_hosts for</span>
<span class="s"># HostbasedAuthentication</span>
<span class="s">#IgnoreUserKnownHosts no</span>
<span class="s"># Don&#39;t read the user&#39;s ~/.rhosts and ~/.shosts files</span>
<span class="s">#IgnoreRhosts yes</span>

<span class="s"># To disable tunneled clear text passwords, change to no here!</span>
<span class="s">PasswordAuthentication no</span>
<span class="s">PermitEmptyPasswords no</span>

<span class="s"># Change to yes to enable challenge-response passwords (beware issues with</span>
<span class="s"># some PAM modules and threads)</span>
<span class="s">ChallengeResponseAuthentication no</span>

<span class="s"># Kerberos options</span>
<span class="s">#KerberosAuthentication no</span>
<span class="s">#KerberosOrLocalPasswd yes</span>
<span class="s">#KerberosTicketCleanup yes</span>
<span class="s">#KerberosGetAFSToken no</span>

<span class="s"># GSSAPI options</span>
<span class="s">#GSSAPIAuthentication no</span>
<span class="s">#GSSAPICleanupCredentials yes</span>
<span class="s">#GSSAPIStrictAcceptorCheck yes</span>
<span class="s">#GSSAPIKeyExchange no</span>

<span class="s"># Set this to &#39;yes&#39; to enable PAM authentication, account processing,</span>
<span class="s"># and session processing. If this is enabled, PAM authentication will</span>
<span class="s"># be allowed through the ChallengeResponseAuthentication and</span>
<span class="s"># PasswordAuthentication.  Depending on your PAM configuration,</span>
<span class="s"># PAM authentication via ChallengeResponseAuthentication may bypass</span>
<span class="s"># the setting of &quot;PermitRootLogin without-password&quot;.</span>
<span class="s"># If you just want the PAM account and session checks to run without</span>
<span class="s"># PAM authentication, then enable this but set PasswordAuthentication</span>
<span class="s"># and ChallengeResponseAuthentication to &#39;no&#39;.</span>
<span class="s">UsePAM yes</span>

<span class="s">#AllowAgentForwarding yes</span>
<span class="s">#AllowTcpForwarding yes</span>
<span class="s">#GatewayPorts no</span>
<span class="s">X11Forwarding yes</span>
<span class="s">#X11DisplayOffset 10</span>
<span class="s">#X11UseLocalhost yes</span>
<span class="s">#PermitTTY yes</span>
<span class="s">PrintMotd no</span>
<span class="s">#PrintLastLog yes</span>
<span class="s">#TCPKeepAlive yes</span>
<span class="s">#UseLogin no</span>
<span class="s">#PermitUserEnvironment no</span>
<span class="s">#Compression delayed</span>
<span class="s">#ClientAliveInterval 0</span>
<span class="s">#ClientAliveCountMax 3</span>
<span class="s">#UseDNS no</span>
<span class="s">#PidFile /var/run/sshd.pid</span>
<span class="s">#MaxStartups 10:30:100</span>
<span class="s">#PermitTunnel no</span>
<span class="s">#ChrootDirectory none</span>
<span class="s">#VersionAddendum none</span>

<span class="s"># no default banner path</span>
<span class="s">#Banner none</span>

<span class="s"># Allow client to pass locale environment variables</span>
<span class="s">AcceptEnv LANG LC_*</span>

<span class="s"># override default of no subsystems</span>
<span class="s">Subsystem   sftp    /usr/lib/openssh/sftp-server</span>

<span class="s"># Example of overriding settings on a per-user basis</span>
<span class="s">#Match User anoncvs</span>
<span class="s">#   X11Forwarding no</span>
<span class="s">#   AllowTcpForwarding no</span>
<span class="s">#   PermitTTY no</span>
<span class="s">#   ForceCommand cvs server</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>

<h4 id="delete-roots-authorized_keys-file">Delete root's <code>authorized_keys</code> file<a class="headerlink" href="#delete-roots-authorized_keys-file" title="Permanent link">&para;</a></h4>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please check before if you can login to the user <code>user</code> with your ssh-key!</p>
</div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>rm ~/.ssh/authorized_keys
</pre></div>
</td></tr></table>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Log out and re login as <code>user</code>!</p>
</div>
<h3 id="install-base-packages">Install base packages<a class="headerlink" href="#install-base-packages" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo apt install -y <span class="se">\</span>
p7zip-full <span class="se">\</span>
p7zip-rar <span class="se">\</span>
zip <span class="se">\</span>
unzip <span class="se">\</span>
unrar <span class="se">\</span>
screen <span class="se">\</span>
tmux <span class="se">\</span>
htop
</pre></div>
</td></tr></table>

<h2 id="install-znc">Install ZNC<a class="headerlink" href="#install-znc" title="Permanent link">&para;</a></h2>
<p>You can find a detailed install instruction here: <a href="https://wiki.znc.in/Installation#Ubuntu">https://wiki.znc.in/Installation#Ubuntu</a></p>
<h3 id="pre-requiemetns">Pre-requiemetns<a class="headerlink" href="#pre-requiemetns" title="Permanent link">&para;</a></h3>
<p>Install python-software-properties:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo apt install -y software-properties-common
</pre></div>
</td></tr></table></p>
<p>Create user for running znc:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo useradd -r -s /usr/sbin/nologin znc
</pre></div>
</td></tr></table></p>
<p>Create a config directory for znc:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo mkdir /etc/znc <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo chown znc:znc /etc/znc<span class="p">;</span> <span class="se">\</span>
sudo chmod <span class="m">750</span> /etc/znc
</pre></div>
</td></tr></table></p>
<h3 id="install-znc_1">Install ZNC<a class="headerlink" href="#install-znc_1" title="Permanent link">&para;</a></h3>
<p>Add PPA and install:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo add-apt-repository ppa:teward/znc <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo apt update <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo apt install -y znc znc-dev znc-perl znc-python znc-tcl
</pre></div>
</td></tr></table></p>
<h3 id="configure-znc">Configure ZNC<a class="headerlink" href="#configure-znc" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo -u znc znc -c -d /etc/znc
</pre></div>
</td></tr></table>

<p>Configuration Options:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>[ .. ] Checking for list of available modules...
[ ** ]
[ ** ] -- Global settings --
[ ** ]
[ ?? ] Listen on port (1025 to 65534): 6667
[ !! ] WARNING: Some web browsers reject port 6667. If you intend to
[ !! ] use ZNC&#39;s web interface, you might want to use another port.
[ ?? ] Proceed with port 6667 anyway? (yes/no) [yes]:
[ ?? ] Listen using SSL (yes/no) [no]: yes
[ ?? ] Listen using both IPv4 and IPv6 (yes/no) [yes]:
[ .. ] Verifying the listener...
[ ** ] Unable to locate pem file: [/etc/znc/znc.pem], creating it
[ .. ] Writing Pem file [/etc/znc/znc.pem]...
[ ** ] Enabled global modules [webadmin]
[ ** ]
[ ** ] -- Admin user settings --
[ ** ]
[ ?? ] Username (alphanumeric): admin
[ ?? ] Enter password:
[ ?? ] Confirm password:
[ ?? ] Nick [admin]:
[ ?? ] Alternate nick [admin_]:
[ ?? ] Ident [admin]:
[ ?? ] Real name (optional):
[ ?? ] Bind host (optional):
[ ** ] Enabled user modules [chansaver, controlpanel]
[ ** ]
[ ?? ] Set up a network? (yes/no) [yes]:
[ ** ]
[ ** ] -- Network settings --
[ ** ]
[ ?? ] Name [freenode]:
[ ?? ] Server host [chat.freenode.net]: ^C
user@znc /etc $ sudo -u znc znc -c -d /etc/znc
[ .. ] Checking for list of available modules...
[ ** ]
[ ** ] -- Global settings --
[ ** ]
[ ?? ] Listen on port (1025 to 65534): 6667
[ !! ] WARNING: Some web browsers reject port 6667. If you intend to
[ !! ] use ZNC&#39;s web interface, you might want to use another port.
[ ?? ] Proceed with port 6667 anyway? (yes/no) [yes]:
[ ?? ] Listen using SSL (yes/no) [no]: yes
[ ?? ] Listen using both IPv4 and IPv6 (yes/no) [yes]:
[ .. ] Verifying the listener...
[ ** ] Enabled global modules [webadmin]
[ ** ]
[ ** ] -- Admin user settings --
[ ** ]
[ ?? ] Username (alphanumeric): admin
[ ?? ] Enter password:
[ ?? ] Confirm password:
[ ?? ] Nick [admin]:
[ ?? ] Alternate nick [admin_]:
[ ?? ] Ident [admin]:
[ ?? ] Real name (optional):
[ ?? ] Bind host (optional):
[ ** ] Enabled user modules [chansaver, controlpanel]
[ ** ]
[ ?? ] Set up a network? (yes/no) [yes]: no
[ ** ]
[ .. ] Writing config [/etc/znc/configs/znc.conf]...
[ ** ]
[ ** ] To connect to this ZNC you need to connect to it as your IRC server
[ ** ] using the port that you supplied.  You have to supply your login info
[ ** ] as the IRC server password like this: user/network:pass.
[ ** ]
[ ** ] Try something like this in your IRC client...
[ ** ] /server &lt;znc_server_ip&gt; +6667 admin:&lt;pass&gt;
[ ** ]
[ ** ] To manage settings, users and networks, point your web browser to
[ ** ] https://&lt;znc_server_ip&gt;:6667/
[ ** ]
[ ?? ] Launch ZNC now? (yes/no) [yes]: no
</pre></div>
</td></tr></table></p>
<h3 id="znc-service">ZNC service<a class="headerlink" href="#znc-service" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sudo tee /etc/systemd/system/znc.service &amp;&amp; \</span>
<span class="s">sudo systemctl daemon-reload &amp;&amp; \</span>
<span class="s">sudo systemctl enable znc</span>
<span class="s">[Unit]</span>
<span class="s">Description=ZNC, an advanced IRC bouncer</span>
<span class="s">After=network-online.target</span>

<span class="s">[Service]</span>
<span class="s">ExecStart=/usr/bin/znc -f --datadir=/etc/znc</span>
<span class="s">User=znc</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>

<h2 id="nginx">Nginx<a class="headerlink" href="#nginx" title="Permanent link">&para;</a></h2>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h3>
<p>Install all needed Packages for nginx tasks: 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo apt update <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo apt install -y <span class="se">\</span>
nginx <span class="se">\</span>
python3-pip <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo -H pip3 install --system --upgrade <span class="se">\</span>
pip <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo -H pip3 install --upgrade <span class="se">\</span>
cryptography <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo -H pip3 install --upgrade <span class="se">\</span>
setuptools <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo -H pip3 install <span class="se">\</span>
certbot <span class="se">\</span>
certbot-nginx
</pre></div>
</td></tr></table></p>
<h3 id="configure">Configure<a class="headerlink" href="#configure" title="Permanent link">&para;</a></h3>
<h4 id="delete-default-entry">Delete default entry<a class="headerlink" href="#delete-default-entry" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo rm /etc/nginx/sites-enabled/default
</pre></div>
</td></tr></table>

<h4 id="add-ssl_params">Add ssl_params<a class="headerlink" href="#add-ssl_params" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sudo tee /etc/nginx/ssl_params</span>
<span class="s"># Session settings</span>
<span class="s">ssl_session_timeout 1d;</span>
<span class="s">ssl_session_cache shared:SSL:50m;</span>
<span class="s">ssl_session_tickets off;</span>

<span class="s"># modern configuration. tweak to your needs.</span>
<span class="s">ssl_protocols TLSv1.2;</span>
<span class="s">ssl_ciphers &#39;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256&#39;;</span>
<span class="s">ssl_prefer_server_ciphers on;</span>

<span class="s"># HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)</span>
<span class="s">add_header Strict-Transport-Security max-age=15768000;</span>

<span class="s"># OCSP Stapling ---</span>
<span class="s"># fetch OCSP records from URL in ssl_certificate and cache them</span>
<span class="s">ssl_stapling on;</span>
<span class="s">ssl_stapling_verify on;</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>

<h4 id="general-http-to-https-redirector">General HTTP to HTTPS redirector<a class="headerlink" href="#general-http-to-https-redirector" title="Permanent link">&para;</a></h4>
<p>This nginx entry will rewrite all traffic from HTTP to HTTPS.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">read</span> -r -d <span class="s1">&#39;&#39;</span> read_tmp&lt;&lt;<span class="s2">&quot;EOF&quot;</span>
server <span class="o">{</span>
<span class="se">\t</span>listen <span class="m">80</span> default_server<span class="p">;</span>
<span class="se">\t</span>listen <span class="o">[</span>::<span class="o">]</span>:80 default_server<span class="p">;</span>
<span class="se">\t</span>server_name _<span class="p">;</span>
<span class="se">\t</span>return <span class="m">301</span> https://<span class="nv">$host$request_uri</span><span class="p">;</span>
<span class="o">}</span>
EOF
<span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="nv">$read_tmp</span><span class="s2">&quot;</span> <span class="p">|</span> sudo tee /etc/nginx/sites-available/99-https-rewrite.conf <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo ln -s ../sites-available/99-https-rewrite.conf /etc/nginx/sites-enabled/99-https-rewrite.conf
</pre></div>
</td></tr></table></p>
<h4 id="znc-web-interface-on-port-443">ZNC web interface on Port 443<a class="headerlink" href="#znc-web-interface-on-port-443" title="Permanent link">&para;</a></h4>
<p>Add server directive for Portainer:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sed &#39;s/\\t/\t/g&#39; | sudo tee /etc/nginx/sites-available/10-znc.mischaufen.de.conf &amp;&amp; \</span>
<span class="s">sudo ln -s ../sites-available/10-znc.mischaufen.de.conf /etc/nginx/sites-enabled/10-znc.mischaufen.de.conf</span>
<span class="s">server {</span>
<span class="s">\tlisten\t\t443 ssl http2;</span>
<span class="s">\tlisten\t\t[::]:443 ssl http2;</span>
<span class="s">\tserver_name\tznc.mischaufen.de;</span>

<span class="s">\taccess_log\t/var/log/nginx/znc.mischaufen.de_access.log combined gzip=9;</span>
<span class="s">\terror_log\t/var/log/nginx/znc.mischaufen.de_error.log warn;</span>

<span class="s">\tlocation / {</span>
<span class="s">\t\tproxy_pass\t\thttps://[::1]:6667/;</span>
<span class="s">\t\tproxy_set_header\tHost \$host;</span>
<span class="s">\t\tproxy_set_header\tX-Forwarded-Host \$server_name;</span>
<span class="s">\t\tproxy_set_header\tX-Forwarded-For \$proxy_add_x_forwarded_for;</span>
<span class="s">\t}</span>

<span class="s">\tinclude\t\t/etc/nginx/ssl_params;</span>

<span class="s">}</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table></p>
<p>Install a Let's encrypt SSL Certificate:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Don't add a redirect to HTTPS.</p>
</div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo certbot --nginx -d znc.mischaufen.de <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo sed -i <span class="s1">&#39;/ssl_certificate_key/a \ \ \ \ ssl_trusted_certificate /etc/letsencrypt/live/znc.mischaufen.de/chain.pem;&#39;</span> /etc/nginx/sites-available/10-znc.mischaufen.de.conf <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo systemctl reload nginx.service
</pre></div>
</td></tr></table>

<h3 id="add-cronjob-for-renewing-cetificates">Add cronjob for renewing cetificates<a class="headerlink" href="#add-cronjob-for-renewing-cetificates" title="Permanent link">&para;</a></h3>
<p>This cronjob renews the certificat and create one for znc.</p>
<p><code>sudo crontab -e</code>:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>0 */12 * * * /usr/local/bin/certbot renew &amp;&amp; cat /etc/letsencrypt/live/znc.mischaufen.de/{privkey,cert,chain}.pem &gt; /etc/znc/znc.pem
</pre></div>
</td></tr></table></p>
<h2 id="znc-ssl-config">ZNC SSL config<a class="headerlink" href="#znc-ssl-config" title="Permanent link">&para;</a></h2>
<h3 id="initial-copy-of-our-lets-encrypt-certificates-to-znc">Initial copy of our let's encrypt certificates to znc<a class="headerlink" href="#initial-copy-of-our-lets-encrypt-certificates-to-znc" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo cat /etc/letsencrypt/live/znc.mischaufen.de/<span class="o">{</span>privkey,cert,chain<span class="o">}</span>.pem <span class="p">|</span> sudo tee /etc/znc/znc.pem
</pre></div>
</td></tr></table>

<h3 id="run-znc-for-the-1st-time">Run ZNC for the 1<sup>st</sup> time<a class="headerlink" href="#run-znc-for-the-1st-time" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo systemctl start znc.service
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="http://pphg.tech" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://keybase.io/philip_henning" class="md-footer-social__link fa fa-key"></a>
    
      <a href="https://twitter.com/__phg" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/shokinn" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://gitlab.com/shokinn" class="md-footer-social__link fa fa-gitlab"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
    
      
    
  </body>
</html>