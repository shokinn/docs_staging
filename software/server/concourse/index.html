



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Everything which I have to write down to remember it">
      
      
      
        <meta name="author" content="Philip Henning">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Concourse - Philip's docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../../#concourse" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Philip's docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Philip's docs
              </span>
              <span class="md-header-nav__topic">
                Concourse
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/shokinn/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      shokinn/docs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Philip's docs" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    Philip's docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/shokinn/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      shokinn/docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Hardware
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Hardware
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Dell XPS 15 9560
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Dell XPS 15 9560
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../hardware/dell_xps_15_9560/dell_xps_15_9560_arch_linux/" title="Arch Linux" class="md-nav__link">
      Arch Linux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Desktop
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Desktop
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../desktop/playonlinux/" title="PlayOnLinux" class="md-nav__link">
      PlayOnLinux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../concourse_dockerized/" title="Concourse Dockerized" class="md-nav__link">
      Concourse Dockerized
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quassel/" title="Quassel" class="md-nav__link">
      Quassel
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Knowledge base
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Knowledge base
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kb/change_tty/" title="How to change to TTYn" class="md-nav__link">
      How to change to TTYn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kb/mkdocs/" title="MkDocs testing environment" class="md-nav__link">
      MkDocs testing environment
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../imprint/" title="Impressum" class="md-nav__link">
      Impressum
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../datenschutzerklaerung/" title="Datenschutzerklärung" class="md-nav__link">
      Datenschutzerklärung
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-server-setup" title="Initial Server setup" class="md-nav__link">
    Initial Server setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-system" title="Update System" class="md-nav__link">
    Update System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edit-bashrc" title="Edit .bashrc" class="md-nav__link">
    Edit .bashrc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-vim-colored-with-dark-background-settinfs" title="Make vim colored with dark background settinfs" class="md-nav__link">
    Make vim colored with dark background settinfs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-user-user" title="Create a new user user" class="md-nav__link">
    Create a new user user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-the-ssh-deamon-to-allow-only-ssh-keys" title="Change the SSH deamon to allow only SSH-keys" class="md-nav__link">
    Change the SSH deamon to allow only SSH-keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-roots-authorized_keys-file" title="Delete root's authorized_keys file" class="md-nav__link">
    Delete root's authorized_keys file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-base-packages" title="Install base packages" class="md-nav__link">
    Install base packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-locale" title="Fix locale" class="md-nav__link">
    Fix locale
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql" title="PostgreSQL" class="md-nav__link">
    PostgreSQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure" title="Configure" class="md-nav__link">
    Configure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup" title="Backup" class="md-nav__link">
    Backup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concourse_1" title="Concourse" class="md-nav__link">
    Concourse
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install_1" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure_1" title="Configure" class="md-nav__link">
    Configure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-key-files" title="Creating the Key Files" class="md-nav__link">
    Creating the Key Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-environment-configuration-files" title="Creating the Environment Configuration Files" class="md-nav__link">
    Creating the Environment Configuration Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-dedicated-system-user-and-adjusting-permissions" title="Creating a Dedicated System User and Adjusting Permissions" class="md-nav__link">
    Creating a Dedicated System User and Adjusting Permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-systemd-unit-files-for-the-web-and-worker-processes" title="Create Systemd Unit Files for the Web and Worker Processes" class="md-nav__link">
    Create Systemd Unit Files for the Web and Worker Processes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-concourse-web-unit-file" title="Creating the Concourse Web Unit File" class="md-nav__link">
    Creating the Concourse Web Unit File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-concourse-worker-unit-file" title="Creating the Concourse Worker Unit File" class="md-nav__link">
    Creating the Concourse Worker Unit File
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-and-enable-the-services" title="Start and enable the Services" class="md-nav__link">
    Start and enable the Services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-access-on-the-command-line" title="Check Access On the Command Line" class="md-nav__link">
    Check Access On the Command Line
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checking-access-on-the-command-line" title="Checking Access On the Command Line" class="md-nav__link">
    Checking Access On the Command Line
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx" title="Nginx" class="md-nav__link">
    Nginx
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install_2" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure_2" title="Configure" class="md-nav__link">
    Configure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-default-entry" title="Delete default entry" class="md-nav__link">
    Delete default entry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-ssl_params" title="Add ssl_params" class="md-nav__link">
    Add ssl_params
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-http-to-https-redirector" title="General HTTP to HTTPS redirector" class="md-nav__link">
    General HTTP to HTTPS redirector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concourse_2" title="Concourse" class="md-nav__link">
    Concourse
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-cronjob-for-renewing-cetificates" title="Add cronjob for renewing cetificates" class="md-nav__link">
    Add cronjob for renewing cetificates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" title="Security" class="md-nav__link">
    Security
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iptables" title="iptables" class="md-nav__link">
    iptables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/shokinn/docs/edit/master/docs/software/server/concourse.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="concourse">Concourse<a class="headerlink" href="#concourse" title="Permanent link">&para;</a></h1>
<p>OS: Ubuntu 16.04 LTS</p>
<h2 id="initial-server-setup">Initial Server setup<a class="headerlink" href="#initial-server-setup" title="Permanent link">&para;</a></h2>
<h3 id="update-system">Update System<a class="headerlink" href="#update-system" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>apt update <span class="o">&amp;&amp;</span> apt full-upgrade -y
</pre></div>
</td></tr></table>

<h3 id="edit-bashrc">Edit .bashrc<a class="headerlink" href="#edit-bashrc" title="Permanent link">&para;</a></h3>
<p><code>/root/.bashrc</code> / <code>/etc/skel/.bashrc</code>:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104</pre></div></td><td class="code"><div class="codehilite"><pre><span></span># ~/.bashrc: executed by bash(1) for non-login shells.
# see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)
# for examples

# If not running interactively, don&#39;t do anything
[ -z &quot;$PS1&quot; ] &amp;&amp; return

# don&#39;t put duplicate lines in the history. See bash(1) for more options
# ... or force ignoredups and ignorespace
HISTCONTROL=ignoredups:ignorespace

# append to the history file, don&#39;t overwrite it
shopt -s histappend

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
HISTSIZE=999999
HISTFILESIZE=999999

# check the window size after each command and, if necessary,
# update the values of LINES and COLUMNS.
shopt -s checkwinsize

# make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] &amp;&amp; eval &quot;$(SHELL=/bin/sh lesspipe)&quot;

# set variable identifying the chroot you work in (used in the prompt below)
if [ -z &quot;$debian_chroot&quot; ] &amp;&amp; [ -r /etc/debian_chroot ]; then
    debian_chroot=$(cat /etc/debian_chroot)
fi

# set a fancy prompt (non-color, unless we know we &quot;want&quot; color)
case &quot;$TERM&quot; in
    xterm-color) color_prompt=yes;;
esac

# uncomment for a colored prompt, if the terminal has the capability; turned
# off by default to not distract the user: the focus in a terminal window
# should be on the output of commands, not on the prompt
force_color_prompt=yes

if [ -n &quot;$force_color_prompt&quot; ]; then
    if [ -x /usr/bin/tput ] &amp;&amp; tput setaf 1 &gt;&amp;/dev/null; then
    # We have color support; assume it&#39;s compliant with Ecma-48
    # (ISO/IEC-6429). (Lack of such support is extremely rare, and such
    # a case would tend to support setf rather than setaf.)
    color_prompt=yes
    else
    color_prompt=
    fi
fi

if [ &quot;$color_prompt&quot; = yes ]; then
    # PS1=&#39;${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ &#39;
    if [ $UID == 0 ]; then
        PS1=&#39;${debian_chroot:+($debian_chroot)}\[\033[01;31m\]\u\[\033[01;33m\]@\[\033[01;36m\]\h \[\033[01;33m\]\w \[\033[01;35m\]\$ \[\033[00m\]&#39;
    else
        PS1=&#39;${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u\[\033[01;33m\]@\[\033[01;36m\]\h \[\033[01;33m\]\w \[\033[01;35m\]\$ \[\033[00m\]&#39;
    fi
else
    PS1=&#39;${debian_chroot:+($debian_chroot)}\u@\h:\w\$ &#39;
fi
unset color_prompt force_color_prompt

# If this is an xterm set the title to user@host:dir
case &quot;$TERM&quot; in
xterm*|rxvt*)
    PS1=&quot;\[\e]0;${debian_chroot:+($debian_chroot)}\u@\h: \w\a\]$PS1&quot;
    ;;
*)
    ;;
esac

# enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors &amp;&amp; eval &quot;$(dircolors -b ~/.dircolors)&quot; || eval &quot;$(dircolors -b)&quot;
    alias ls=&#39;ls --color=auto&#39;
    #alias dir=&#39;dir --color=auto&#39;
    #alias vdir=&#39;vdir --color=auto&#39;

    alias grep=&#39;grep --color=auto&#39;
    alias fgrep=&#39;fgrep --color=auto&#39;
    alias egrep=&#39;egrep --color=auto&#39;
fi

# some more ls aliases
alias ll=&#39;ls -alF&#39;
alias la=&#39;ls -A&#39;
alias l=&#39;ls -CF&#39;

# Alias definitions.
# You may want to put all your additions into a separate file like
# ~/.bash_aliases, instead of adding them here directly.
# See /usr/share/doc/bash-doc/examples in the bash-doc package.

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

# enable programmable completion features (you don&#39;t need to enable
# this, if it&#39;s already enabled in /etc/bash.bashrc and /etc/profile
# sources /etc/bash.bashrc).
#if [ -f /etc/bash_completion ] &amp;&amp; ! shopt -oq posix; then
#    . /etc/bash_completion
#fi
</pre></div>
</td></tr></table></p>
<h3 id="make-vim-colored-with-dark-background-settinfs">Make vim colored with dark background settinfs<a class="headerlink" href="#make-vim-colored-with-dark-background-settinfs" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF &gt;&gt; /etc/vim/vimrc</span>

<span class="s">&quot; Set background to dark for better readability in SSH connections</span>
<span class="s">set background=dark</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>

<h3 id="create-a-new-user-user">Create a new user <code>user</code><a class="headerlink" href="#create-a-new-user-user" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>adduser user <span class="o">&amp;&amp;</span> <span class="se">\</span>
usermod -aG sudo user <span class="o">&amp;&amp;</span> <span class="se">\</span>
mkdir /home/user/.ssh <span class="o">&amp;&amp;</span> <span class="se">\</span>
chmod <span class="m">700</span> /home/user/.ssh <span class="o">&amp;&amp;</span> <span class="se">\</span>
cp /root/.ssh/authorized_keys /home/user/.ssh/ <span class="o">&amp;&amp;</span> <span class="se">\</span>
chmod <span class="m">400</span> /home/user/.ssh/authorized_keys <span class="o">&amp;&amp;</span> <span class="se">\</span>
chown -R user:user /home/user/.ssh/
</pre></div>
</td></tr></table>

<h3 id="change-the-ssh-deamon-to-allow-only-ssh-keys">Change the SSH deamon to allow only SSH-keys<a class="headerlink" href="#change-the-ssh-deamon-to-allow-only-ssh-keys" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF &gt; /etc/ssh/sshd_config &amp;&amp; systemctl restart sshd.service</span>
<span class="s">#   $OpenBSD: sshd_config,v 1.101 2017/03/14 07:19:07 djm Exp $</span>

<span class="s"># This is the sshd server system-wide configuration file.  See</span>
<span class="s"># sshd_config(5) for more information.</span>

<span class="s"># This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin</span>

<span class="s"># The strategy used for options in the default sshd_config shipped with</span>
<span class="s"># OpenSSH is to specify options with their default value where</span>
<span class="s"># possible, but leave them commented.  Uncommented options override the</span>
<span class="s"># default value.</span>

<span class="s">Port 22</span>
<span class="s">AddressFamily any</span>
<span class="s">ListenAddress 0.0.0.0</span>
<span class="s">ListenAddress ::</span>

<span class="s">HostKey /etc/ssh/ssh_host_rsa_key</span>
<span class="s">HostKey /etc/ssh/ssh_host_ecdsa_key</span>
<span class="s">HostKey /etc/ssh/ssh_host_ed25519_key</span>

<span class="s"># Ciphers and keying</span>
<span class="s">#RekeyLimit default none</span>

<span class="s"># Logging</span>
<span class="s">#SyslogFacility AUTH</span>
<span class="s">#LogLevel INFO</span>

<span class="s"># Authentication:</span>

<span class="s">#LoginGraceTime 2m</span>
<span class="s">PermitRootLogin without-password</span>
<span class="s">#StrictModes yes</span>
<span class="s">#MaxAuthTries 6</span>
<span class="s">#MaxSessions 10</span>

<span class="s">PubkeyAuthentication yes</span>

<span class="s"># Expect .ssh/authorized_keys2 to be disregarded by default in future.</span>
<span class="s">AuthorizedKeysFile  .ssh/authorized_keys .ssh/authorized_keys2</span>

<span class="s">#AuthorizedPrincipalsFile none</span>

<span class="s">#AuthorizedKeysCommand none</span>
<span class="s">#AuthorizedKeysCommandUser nobody</span>

<span class="s"># For this to work you will also need host keys in /etc/ssh/ssh_known_hosts</span>
<span class="s">#HostbasedAuthentication no</span>
<span class="s"># Change to yes if you don&#39;t trust ~/.ssh/known_hosts for</span>
<span class="s"># HostbasedAuthentication</span>
<span class="s">#IgnoreUserKnownHosts no</span>
<span class="s"># Don&#39;t read the user&#39;s ~/.rhosts and ~/.shosts files</span>
<span class="s">#IgnoreRhosts yes</span>

<span class="s"># To disable tunneled clear text passwords, change to no here!</span>
<span class="s">PasswordAuthentication no</span>
<span class="s">PermitEmptyPasswords no</span>

<span class="s"># Change to yes to enable challenge-response passwords (beware issues with</span>
<span class="s"># some PAM modules and threads)</span>
<span class="s">ChallengeResponseAuthentication no</span>

<span class="s"># Kerberos options</span>
<span class="s">#KerberosAuthentication no</span>
<span class="s">#KerberosOrLocalPasswd yes</span>
<span class="s">#KerberosTicketCleanup yes</span>
<span class="s">#KerberosGetAFSToken no</span>

<span class="s"># GSSAPI options</span>
<span class="s">#GSSAPIAuthentication no</span>
<span class="s">#GSSAPICleanupCredentials yes</span>
<span class="s">#GSSAPIStrictAcceptorCheck yes</span>
<span class="s">#GSSAPIKeyExchange no</span>

<span class="s"># Set this to &#39;yes&#39; to enable PAM authentication, account processing,</span>
<span class="s"># and session processing. If this is enabled, PAM authentication will</span>
<span class="s"># be allowed through the ChallengeResponseAuthentication and</span>
<span class="s"># PasswordAuthentication.  Depending on your PAM configuration,</span>
<span class="s"># PAM authentication via ChallengeResponseAuthentication may bypass</span>
<span class="s"># the setting of &quot;PermitRootLogin without-password&quot;.</span>
<span class="s"># If you just want the PAM account and session checks to run without</span>
<span class="s"># PAM authentication, then enable this but set PasswordAuthentication</span>
<span class="s"># and ChallengeResponseAuthentication to &#39;no&#39;.</span>
<span class="s">UsePAM yes</span>

<span class="s">#AllowAgentForwarding yes</span>
<span class="s">#AllowTcpForwarding yes</span>
<span class="s">#GatewayPorts no</span>
<span class="s">X11Forwarding yes</span>
<span class="s">#X11DisplayOffset 10</span>
<span class="s">#X11UseLocalhost yes</span>
<span class="s">#PermitTTY yes</span>
<span class="s">PrintMotd no</span>
<span class="s">#PrintLastLog yes</span>
<span class="s">#TCPKeepAlive yes</span>
<span class="s">#UseLogin no</span>
<span class="s">#PermitUserEnvironment no</span>
<span class="s">#Compression delayed</span>
<span class="s">#ClientAliveInterval 0</span>
<span class="s">#ClientAliveCountMax 3</span>
<span class="s">#UseDNS no</span>
<span class="s">#PidFile /var/run/sshd.pid</span>
<span class="s">#MaxStartups 10:30:100</span>
<span class="s">#PermitTunnel no</span>
<span class="s">#ChrootDirectory none</span>
<span class="s">#VersionAddendum none</span>

<span class="s"># no default banner path</span>
<span class="s">#Banner none</span>

<span class="s"># Allow client to pass locale environment variables</span>
<span class="s">AcceptEnv LANG LC_*</span>

<span class="s"># override default of no subsystems</span>
<span class="s">Subsystem   sftp    /usr/lib/openssh/sftp-server</span>

<span class="s"># Example of overriding settings on a per-user basis</span>
<span class="s">#Match User anoncvs</span>
<span class="s">#   X11Forwarding no</span>
<span class="s">#   AllowTcpForwarding no</span>
<span class="s">#   PermitTTY no</span>
<span class="s">#   ForceCommand cvs server</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>

<h4 id="delete-roots-authorized_keys-file">Delete root's <code>authorized_keys</code> file<a class="headerlink" href="#delete-roots-authorized_keys-file" title="Permanent link">&para;</a></h4>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please check before if you can login to the user <code>user</code> with your ssh-key!</p>
</div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>rm ~/.ssh/authorized_keys
</pre></div>
</td></tr></table>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Log out and re login as <code>user</code>!</p>
</div>
<h3 id="install-base-packages">Install base packages<a class="headerlink" href="#install-base-packages" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo apt install -y <span class="se">\</span>
p7zip-full <span class="se">\</span>
p7zip-rar <span class="se">\</span>
unzip <span class="se">\</span>
unrar <span class="se">\</span>
screen <span class="se">\</span>
tmux <span class="se">\</span>
htop
</pre></div>
</td></tr></table>

<h3 id="fix-locale">Fix locale<a class="headerlink" href="#fix-locale" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sudo tee -a /etc/environment</span>

<span class="s"># Fix locale</span>
<span class="s">LC_ALL=en_US.UTF-8</span>
<span class="s">LANGUAGE=en_US:en</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>

<h2 id="postgresql">PostgreSQL<a class="headerlink" href="#postgresql" title="Permanent link">&para;</a></h2>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo apt install -y postgresql postgresql-contrib
</pre></div>
</td></tr></table>

<h3 id="configure">Configure<a class="headerlink" href="#configure" title="Permanent link">&para;</a></h3>
<p>Once the database software is installed, we will create a dedicated PostgreSQL user named concourse to manage the <code>Concourse</code> assets within the database system. To create this user, we will use <code>sudo</code> to act as the <code>postgres</code> system user, which has admin access to the database system:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo -u postgres createuser concourse
</pre></div>
</td></tr></table></p>
<p>By default, Concourse attempts to connect to a database called <code>atc</code>. Concourse calls its main web and API hub the "ATC", which stands for "air traffic control". We can create this database and assign ownership to the <code>concourse</code> database user to provide appropriate access:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo -u postgres createdb --owner<span class="o">=</span>concourse atc
</pre></div>
</td></tr></table></p>
<h3 id="backup">Backup<a class="headerlink" href="#backup" title="Permanent link">&para;</a></h3>
<h2 id="concourse_1">Concourse<a class="headerlink" href="#concourse_1" title="Permanent link">&para;</a></h2>
<h3 id="install_1">Install<a class="headerlink" href="#install_1" title="Permanent link">&para;</a></h3>
<p>Download and install Concourse and fly:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo wget -O /root/concourse_updater.sh https://gist.githubusercontent.com/shokinn/9eb8b9e39e8a73e4ad085cd9c75a3b4f/raw/3c3b29cc08c927bdd60253050b248d9e9f33d67d/concourse_updater.sh <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo chmod u+x /root/concourse_updater.sh <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo /root/concourse_updater.sh<span class="p">;</span> <span class="se">\</span>
sudo wget -O /root/fly_updater.sh https://gist.githubusercontent.com/shokinn/9eb8b9e39e8a73e4ad085cd9c75a3b4f/raw/3c3b29cc08c927bdd60253050b248d9e9f33d67d/fly_updater.sh <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo chmod u+x /root/fly_updater.sh <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo /root/fly_updater.sh
</pre></div>
</td></tr></table></p>
<h3 id="configure_1">Configure<a class="headerlink" href="#configure_1" title="Permanent link">&para;</a></h3>
<p>Next, we can start to put together the configuration and keys that Concourse will use to start up.</p>
<p>Before we begin, create a configuration directory where we can keep all of the relevant files:  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo mkdir /etc/concourse
</pre></div>
</td></tr></table>

<h4 id="creating-the-key-files">Creating the Key Files<a class="headerlink" href="#creating-the-key-files" title="Permanent link">&para;</a></h4>
<p>Concourse is composed of a few related components that all need to be able to communicate securely with one another.</p>
<p>The <a href="https://concourse-ci.org/concepts.html#component-atc">ATC</a> is the main hub that handles web and API requests and coordinates pipelines. <a href="https://concourse-ci.org/concepts.html#architecture-worker">Workers</a> manage containers to run the CI/CD tasks defined in the pipeline. The <a href="https://concourse-ci.org/concepts.html#component-tsa">TSA</a> is a custom SSH server that securely registers workers with the ATC.</p>
<p>Even though we will be running all of these components on a single server, the worker and TSA expect to communicate securely. To satisfy this expectation, we will create three sets of keys:</p>
<ul>
<li>a key pair for the TSA component</li>
<li>a key pair for the worker</li>
<li>a session signing key pair used to sign tokens for user sessions and TSA to ATC communication</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo ssh-keygen -t rsa -q -N <span class="s1">&#39;&#39;</span> -f /etc/concourse/tsa_host_key<span class="p">;</span> <span class="se">\</span>
sudo ssh-keygen -t rsa -q -N <span class="s1">&#39;&#39;</span> -f /etc/concourse/worker_key<span class="p">;</span> <span class="se">\</span>
sudo ssh-keygen -t rsa -q -N <span class="s1">&#39;&#39;</span> -f /etc/concourse/session_signing_key
</pre></div>
</td></tr></table>

<p>If we check in the concourse directory, we can see that three public and three private keys are now available:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>ls -l /etc/concourse
</pre></div>
</td></tr></table></p>
<p>Output:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>total 24
-rw------- 1 root root 1679 May 11 17:19 session_signing_key
-rw-r--r-- 1 root root  394 May 11 17:19 session_signing_key.pub
-rw------- 1 root root 1679 May 11 17:19 tsa_host_key
-rw-r--r-- 1 root root  394 May 11 17:19 tsa_host_key.pub
-rw------- 1 root root 1675 May 11 17:19 worker_key
-rw-r--r-- 1 root root  394 May 11 17:19 worker_key.pub
</pre></div>
</td></tr></table></p>
<p>The TSA will decide which workers are authorized to connect to the system by checking an authorized key file. We need to pre-populate the authorized keys file with the worker's public key that we generated so that it can connect successfully.</p>
<p>Since this is our only worker, we can just copy the file over:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo cp /etc/concourse/worker_key.pub /etc/concourse/authorized_worker_keys
</pre></div>
</td></tr></table></p>
<p>Now that we have the key files and an initial file for authorized workers, we can create the files that will define our Concourse configuration.</p>
<h4 id="creating-the-environment-configuration-files">Creating the Environment Configuration Files<a class="headerlink" href="#creating-the-environment-configuration-files" title="Permanent link">&para;</a></h4>
<p>The Concourse binary does not read from a configuration file natively. However, it can take configuration values from environment variables passed in when the process starts.</p>
<p>In a moment, we will be creating <code>systemd</code> unit files to define and manage our Concourse services. The unit files can read environment variables from a file and pass them to the process as it starts. We will create a file that defines the variables for the Concourse <code>web</code> process, which start the ATC and TSA components, and another file for the Concourse <code>worker</code> process.</p>
<p>Create a file for the <code>web</code> process.</p>
<p>Inside, we will define the environment variables needed by the ATC and TSA components. Each variable begins with <code>CONCOURSE_</code>.
To start, we will define some static values that we don't need to modify. These variables will define the location of the private TSA and session keys, the file defining the authorized workers, and the PostgreSQL socket location:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sudo tee /etc/concourse/web_environment</span>
<span class="s"># These values can be used as-is</span>
<span class="s">CONCOURSE_SESSION_SIGNING_KEY=/etc/concourse/session_signing_key</span>
<span class="s">CONCOURSE_TSA_HOST_KEY=/etc/concourse/tsa_host_key</span>
<span class="s">CONCOURSE_TSA_AUTHORIZED_KEYS=/etc/concourse/authorized_worker_keys</span>
<span class="s">CONCOURSE_POSTGRES_SOCKET=/var/run/postgresql</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table></p>
<p>Next, we'll set some variables that will need to be changed to match your environment. The <code>CONCOURSE_EXTERNAL_URL</code> defines the IP address and port that the service will bind to. Set this to your server's public IP address and port 8080.</p>
<p>We will also set a username and password for the <code>main</code> team, which functions as the Concourse administrative group. You can select any username and password you'd like here. You can change the admin credentials at any time by modifying these values and restarting the service:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
<span class="nb">unset</span> pw<span class="p">;</span> <span class="se">\</span>
<span class="nb">unset</span> pw_confirm<span class="p">;</span> <span class="se">\</span>
<span class="nb">read</span> -s -p <span class="s2">&quot;Enter admin user password: &quot;</span> pw<span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">read</span> -s -p <span class="s2">&quot;Confirm admin user password: &quot;</span> pw_confirm<span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$pw</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="nv">$pw_confirm</span><span class="s2">&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
break<span class="p">;</span> <span class="se">\</span>
<span class="k">else</span> <span class="se">\</span>
<span class="nb">echo</span> <span class="s2">&quot;Your passwords don&#39;t match. Try again!&quot;</span><span class="p">;</span> <span class="se">\</span>
<span class="nb">echo</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="se">\</span>
<span class="k">fi</span><span class="p">;</span> <span class="se">\</span>
<span class="k">done</span><span class="p">;</span> <span class="se">\</span>
<span class="nb">read</span> -p <span class="s2">&quot;Enter the public URL for concours (without http(s)://): &quot;</span> ext_url<span class="p">;</span> <span class="se">\</span>
cat <span class="s">&lt;&lt; EOF | sudo tee -a /etc/concourse/web_environment; \</span>
<span class="s">unset pw; \</span>
<span class="s">unset pw_confirm; \</span>
<span class="s">unset ext_url</span>

<span class="s"># Change these values to match your environment</span>
<span class="s">CONCOURSE_BASIC_AUTH_USERNAME=admin</span>
<span class="s">CONCOURSE_BASIC_AUTH_PASSWORD=$pw</span>
<span class="s">CONCOURSE_EXTERNAL_URL=https://$ext_url</span>
<span class="s">CONCOURSE_BIND_IP=127.0.0.1</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table></p>
<p>Next, create an environment file for the worker process.</p>
<p>Inside, we will define the locations of the worker's private key, the TSA's public key, and the directory where the worker will store its files. We will also set the address where the TSA can be reached, which will be the localhost in our case. You can use the values below without modification:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sudo tee /etc/concourse/worker_environment</span>
<span class="s"># These values can be used as-is</span>
<span class="s">CONCOURSE_WORK_DIR=/var/lib/concourse</span>
<span class="s">CONCOURSE_TSA_WORKER_PRIVATE_KEY=/etc/concourse/worker_key</span>
<span class="s">CONCOURSE_TSA_PUBLIC_KEY=/etc/concourse/tsa_host_key.pub</span>
<span class="s">CONCOURSE_TSA_HOST=127.0.0.1:2222</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table></p>
<h4 id="creating-a-dedicated-system-user-and-adjusting-permissions">Creating a Dedicated System User and Adjusting Permissions<a class="headerlink" href="#creating-a-dedicated-system-user-and-adjusting-permissions" title="Permanent link">&para;</a></h4>
<p>Before we move on, we should create a dedicated Linux user to run the Concourse <code>web</code> process. This will allow us to start the web-facing service with limited privileges.</p>
<p>Because of the way that PostgreSQL handles authentication by default, it is important that the username match the PostgreSQL username we created earlier. Create a system user and group called <code>concourse</code> by typing:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo adduser --system --group concourse
</pre></div>
</td></tr></table></p>
<p>We can give the new user ownership over the <code>/etc/concourse</code> directory and its contents by typing:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo chown -R concourse:concourse /etc/concourse
</pre></div>
</td></tr></table></p>
<p>The environment files contain some sensitive data like the administrative username and password for the CI server. Adjust the permissions of the environment files so that regular users cannot read or modify the values in those files:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo chmod <span class="m">600</span> /etc/concourse/*_environment
</pre></div>
</td></tr></table></p>
<p>Our configuration assets are now owned by the <code>concourse</code> system user with limited privileges for other users.</p>
<h4 id="create-systemd-unit-files-for-the-web-and-worker-processes">Create Systemd Unit Files for the Web and Worker Processes<a class="headerlink" href="#create-systemd-unit-files-for-the-web-and-worker-processes" title="Permanent link">&para;</a></h4>
<p>We are now ready to define the Concourse CI unit files that will start and manage the application processes. We will create one file for the <code>web</code> process that handles the TSA and ATC components and one file for the <code>worker</code> process that handles containers for pipeline tasks.</p>
<h5 id="creating-the-concourse-web-unit-file">Creating the Concourse Web Unit File<a class="headerlink" href="#creating-the-concourse-web-unit-file" title="Permanent link">&para;</a></h5>
<p>Start by creating a <code>concourse-web.service</code> file within the <code>/etc/systemd/system</code> file with the following content:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sudo tee /etc/systemd/system/concourse-web.service</span>
<span class="s">[Unit]</span>
<span class="s">Description=Concourse CI web process (ATC and TSA)</span>
<span class="s">After=postgresql.service</span>

<span class="s">[Service]</span>
<span class="s">User=concourse</span>
<span class="s">Restart=on-failure</span>
<span class="s">EnvironmentFile=/etc/concourse/web_environment</span>
<span class="s">ExecStart=/usr/local/bin/concourse web</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table></p>
<p>The first section of the file sets the unit description for the <code>web</code> process and indicates that this unit should be started after the PostgreSQL unit when deciding on ordering.</p>
<p>The <code>[Service]</code> section defines the way that the service will be run. We will run the service as the <code>concourse</code> user we configured earlier and we tell systemd to automatically restart the service if it fails, which can be useful if the process dies from memory constraints or similar issues. We load the <code>web_environment</code> file we defined earlier to establish the environment and we start the actual process by calling <code>concourse web</code>.</p>
<p>The <code>[Install]</code> section tells systemd how to tie the unit to the system start order if we configure the service to start at boot.</p>
<h5 id="creating-the-concourse-worker-unit-file">Creating the Concourse Worker Unit File<a class="headerlink" href="#creating-the-concourse-worker-unit-file" title="Permanent link">&para;</a></h5>
<p>Next, create a similar file to define the worker process with the following content:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sudo tee /etc/systemd/system/concourse-worker.service</span>
<span class="s">[Unit]</span>
<span class="s">Description=Concourse CI worker process</span>
<span class="s">After=concourse-web.service</span>

<span class="s">[Service]</span>
<span class="s">User=root</span>
<span class="s">Restart=on-failure</span>
<span class="s">EnvironmentFile=/etc/concourse/worker_environment</span>
<span class="s">ExecStart=/usr/local/bin/concourse worker</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table></p>
<p>This unit functions similarly to the <code>concourse-web</code> unit. This time, we tell system to start the <code>worker</code> process after the Concourse <code>web</code> process has been started. The <code>worker</code> process is run as the <code>root</code> user instead of <code>concourse</code> because it requires administrative privileges for container management. We load the <code>worker_environment</code> file and use the <code>concourse worker</code> command to start the process.</p>
<h4 id="start-and-enable-the-services">Start and enable the Services<a class="headerlink" href="#start-and-enable-the-services" title="Permanent link">&para;</a></h4>
<p>Reload the deamon files, start the services:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo systemctl daemon-reload<span class="p">;</span> <span class="se">\</span>
sudo systemctl start concourse-web concourse-worker<span class="p">;</span> <span class="se">\</span>
sudo systemctl status concourse-web concourse-worker
</pre></div>
</td></tr></table></p>
<p>Check that both services read "active (running)" and that the log lines do not contain any obvious errors. Pay special attention to the <code>web</code> service to make sure that the log lines do not indicate problems connecting to the database.</p>
<p>If the services started successfully, enable them so that they will start each time the server boots:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo systemctl <span class="nb">enable</span> concourse-web concourse-worker
</pre></div>
</td></tr></table></p>
<h3 id="check-access-on-the-command-line">Check Access On the Command Line<a class="headerlink" href="#check-access-on-the-command-line" title="Permanent link">&para;</a></h3>
<p>Now that the Concourse services is running, we should check that we have access.</p>
<h4 id="checking-access-on-the-command-line">Checking Access On the Command Line<a class="headerlink" href="#checking-access-on-the-command-line" title="Permanent link">&para;</a></h4>
<p>First, let's check that we can access the Concourse service with the <code>fly</code> command line client.</p>
<p>We have to log in using the administrative username and password that we configured in the <code>/etc/concourse/web_environment</code> file using the <code>login</code> subcommand. A single <code>fly</code> binary can be used to contact and manage multiple Concourse servers, so the command uses a concept called "targets" as an alias for different servers. We will call our target "local" to log into the local Concourse server:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fly -t <span class="nb">local</span> login -c http://127.0.0.1:8080
</pre></div>
</td></tr></table></p>
<p>You will be prompted for the username and password for the <code>main</code> team, which we set in the <code>web_environments</code> file. After entering your credentials, "target saved" should be displayed:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>logging in to team &#39;main&#39;

username: admin
password: 

target saved
</pre></div>
</td></tr></table></p>
<p>This indicates that we were able to log in successfully. While we are here, let's verify that the worker process was able to successfully register to the TSA component by typing:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fly -t <span class="nb">local</span> workers
</pre></div>
</td></tr></table></p>
<p>Output:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>name              containers  platform  tags  team  state    version
concourse-server  0           linux     none  none  running  2.1
</pre></div>
</td></tr></table></p>
<p>The <code>fly</code> command is used to configure pipelines and manage the Concourse CI service. The <code>fly help</code> command provides information about additional commands.</p>
<h2 id="nginx">Nginx<a class="headerlink" href="#nginx" title="Permanent link">&para;</a></h2>
<h3 id="install_2">Install<a class="headerlink" href="#install_2" title="Permanent link">&para;</a></h3>
<p>Install all needed Packages for nginx tasks: 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo apt update <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo apt install -y <span class="se">\</span>
nginx <span class="se">\</span>
python3-pip <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo -H pip3 install --system --upgrade <span class="se">\</span>
pip <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo -H pip3 install --upgrade <span class="se">\</span>
cryptography <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo -H pip3 install --upgrade <span class="se">\</span>
setuptools <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo -H pip3 install <span class="se">\</span>
certbot <span class="se">\</span>
certbot-nginx
</pre></div>
</td></tr></table></p>
<h3 id="configure_2">Configure<a class="headerlink" href="#configure_2" title="Permanent link">&para;</a></h3>
<h4 id="delete-default-entry">Delete default entry<a class="headerlink" href="#delete-default-entry" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo rm /etc/nginx/sites-enabled/default
</pre></div>
</td></tr></table>

<h4 id="add-ssl_params">Add ssl_params<a class="headerlink" href="#add-ssl_params" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sudo tee /etc/nginx/ssl_params</span>
<span class="s"># Session settings</span>
<span class="s">ssl_session_timeout 1d;</span>
<span class="s">ssl_session_cache shared:SSL:50m;</span>
<span class="s">ssl_session_tickets off;</span>

<span class="s"># modern configuration. tweak to your needs.</span>
<span class="s">ssl_protocols TLSv1.2;</span>
<span class="s">ssl_ciphers &#39;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256&#39;;</span>
<span class="s">ssl_prefer_server_ciphers on;</span>

<span class="s"># HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)</span>
<span class="s">add_header Strict-Transport-Security max-age=15768000;</span>

<span class="s"># OCSP Stapling ---</span>
<span class="s"># fetch OCSP records from URL in ssl_certificate and cache them</span>
<span class="s">ssl_stapling on;</span>
<span class="s">ssl_stapling_verify on;</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>

<h4 id="general-http-to-https-redirector">General HTTP to HTTPS redirector<a class="headerlink" href="#general-http-to-https-redirector" title="Permanent link">&para;</a></h4>
<p>This nginx entry will rewrite all traffic from HTTP to HTTPS.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">read</span> -r -d <span class="s1">&#39;&#39;</span> read_tmp&lt;&lt;<span class="s2">&quot;EOF&quot;</span>
server <span class="o">{</span>
<span class="se">\t</span>listen <span class="m">80</span> default_server<span class="p">;</span>
<span class="se">\t</span>listen <span class="o">[</span>::<span class="o">]</span>:80 default_server<span class="p">;</span>
<span class="se">\t</span>server_name _<span class="p">;</span>
<span class="se">\t</span>return <span class="m">301</span> https://<span class="nv">$host$request_uri</span><span class="p">;</span>
<span class="o">}</span>
EOF
<span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="nv">$read_tmp</span><span class="s2">&quot;</span> <span class="p">|</span> sudo tee /etc/nginx/sites-available/99-https-rewrite.conf <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo ln -s ../sites-available/99-https-rewrite.conf /etc/nginx/sites-enabled/99-https-rewrite.conf
</pre></div>
</td></tr></table></p>
<h4 id="concourse_2">Concourse<a class="headerlink" href="#concourse_2" title="Permanent link">&para;</a></h4>
<p>Add server directive for Concourse:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cat <span class="s">&lt;&lt; EOF | sed &#39;s/\\t/\t/g&#39; | sudo tee /etc/nginx/sites-available/10-ci.pphg.tech.conf &amp;&amp; \</span>
<span class="s">sudo ln -s ../sites-available/10-ci.pphg.tech.conf /etc/nginx/sites-enabled/10-ci.pphg.tech.conf</span>
<span class="s">upstream concourse {</span>
<span class="s">\tserver\t\t127.0.0.1:8080;</span>
<span class="s">}</span>

<span class="s">server {</span>
<span class="s">\tlisten\t\t443 ssl http2;</span>
<span class="s">\tlisten\t\t[::]:443 ssl http2;</span>
<span class="s">\tserver_name\tci.pphg.tech;</span>

<span class="s">\taccess_log\t/var/log/nginx/ci.pphg.tech_access.log combined gzip=9;</span>
<span class="s">\terror_log\t/var/log/nginx/ci.pphg.tech_error.log warn;</span>

<span class="s">\tlocation / {</span>
<span class="s">\t\tinclude\t\t\tproxy_params;</span>
<span class="s">\t\tproxy_http_version\t1.1;</span>
<span class="s">\t\tproxy_read_timeout\t90;</span>

<span class="s">\t\tproxy_set_header\tUpgrade \$http_upgrade;</span>
<span class="s">\t\tproxy_set_header\tConnection &quot;upgrade&quot;;</span>

<span class="s">\t\tproxy_pass\t\thttp://concourse;</span>
<span class="s">\t}</span>

<span class="s">\tinclude\t\t/etc/nginx/ssl_params;</span>

<span class="s">}</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table></p>
<p>Check if config is ok:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo nginx -t
</pre></div>
</td></tr></table></p>
<p>Install a Let's encrypt SSL Certificate:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Don't add a redirect to HTTPS.</p>
</div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo certbot --nginx -d ci.pphg.tech <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo sed -i <span class="s1">&#39;/ssl_certificate_key/a \ \ \ \ ssl_trusted_certificate /etc/letsencrypt/live/ci.pphg.tech/chain.pem;&#39;</span> /etc/nginx/sites-available/10-ci.pphg.tech.conf <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo systemctl reload nginx.service
</pre></div>
</td></tr></table>

<h3 id="add-cronjob-for-renewing-cetificates">Add cronjob for renewing cetificates<a class="headerlink" href="#add-cronjob-for-renewing-cetificates" title="Permanent link">&para;</a></h3>
<p><code>sudo crontab -e</code>:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>0 */12 * * * /usr/local/bin/certbot renew
</pre></div>
</td></tr></table></p>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<h3 id="iptables">iptables<a class="headerlink" href="#iptables" title="Permanent link">&para;</a></h3>
<details class="tip"><summary>Explanation iptables rules</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Allow loopback</span>
iptables -A OUTPUT -o lo -j ACCEPT
iptables -A INPUT -i lo -j ACCEPT

<span class="c1"># Allow SSH incoming</span>
iptables -t filter -A INPUT -i eth0 -p tcp --dport <span class="m">22</span> -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT

<span class="c1"># Allow web interface SeedBox incoming</span>
iptables -t filter -A INPUT -i eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT

<span class="c1"># Policy DROP INPUT on `eth0`</span>
iptables -t filter -A INPUT -i eth0 -j DROP<span class="p">;</span>

<span class="c1"># Allow output on `eth0`</span>
iptables -t filter -A OUTPUT -o eth0 -j ACCEPT
</pre></div>
</td></tr></table>

</details>
<p>Set up needed iptables rules:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo iptables -A OUTPUT -o lo -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo iptables -A INPUT -i lo -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo iptables -t filter -A INPUT -i eth0 -p tcp --dport <span class="m">22</span> -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo iptables -t filter -A INPUT -i eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo iptables -t filter -A INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo iptables -t filter -A INPUT -i eth0 -j DROP<span class="p">;</span> <span class="se">\</span>
sudo iptables -t filter -A OUTPUT -o eth0 -j ACCEPT
</pre></div>
</td></tr></table>
Set up needed ip6tables rules:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo ip6tables -A OUTPUT -o lo -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo ip6tables -A INPUT -i lo -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo ip6tables -t filter -A INPUT -i eth0 -p tcp --dport <span class="m">22</span> -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo ip6tables -t filter -A INPUT -i eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo ip6tables -t filter -A INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT<span class="p">;</span> <span class="se">\</span>
sudo ip6tables -t filter -A INPUT -i eth0 -j DROP<span class="p">;</span> <span class="se">\</span>
sudo ip6tables -t filter -A OUTPUT -o eth0 -j ACCEPT
</pre></div>
</td></tr></table></p>
<p>Persist iptables rules:<br />
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sudo apt install -y iptables-persistent <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo netfilter-persistent save <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo netfilter-persistent reload
</pre></div>
</td></tr></table></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="http://pphg.tech" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://keybase.io/philip_henning" class="md-footer-social__link fa fa-key"></a>
    
      <a href="https://twitter.com/__phg" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/shokinn" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://gitlab.com/shokinn" class="md-footer-social__link fa fa-gitlab"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
    
      
    
  </body>
</html>