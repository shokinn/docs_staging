



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Everything which I have to write down to remember it">
      
      
      
        <meta name="author" content="Philip Henning">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../..">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Quassel-IRC - Philip's docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="500" height="500"
    viewBox="0 0 500 500" id="__gitlab">
  <g transform="translate(156.197863, 1.160267)">
  	<path fill="currentColor"
        d="M93.667,473.347L93.667,473.347l90.684-279.097H2.983L93.667,
          473.347L93.667,473.347z" />
  </g>
  <g transform="translate(28.531199, 1.160800)" opacity="0.7">
  	<path fill="currentColor"
        d="M221.333,473.345L130.649,194.25H3.557L221.333,473.345L221.333,
          473.345z" />
  </g>
  <g transform="translate(0.088533, 0.255867)" opacity="0.5">
  	<path fill="currentColor"
        d="M32,195.155L32,195.155L4.441,279.97c-2.513,7.735,0.24,16.21,6.821,
          20.99l238.514,173.29 L32,195.155L32,195.155z" />
  </g>
  <g transform="translate(29.421866, 280.255593)">
  	<path fill="currentColor"
        d="M2.667-84.844h127.092L75.14-252.942c-2.811-8.649-15.047-8.649-17.856,
          0L2.667-84.844 L2.667-84.844z" />
  </g>
  <g transform="translate(247.197860, 1.160800)" opacity="0.7">
  	<path fill="currentColor"
        d="M2.667,473.345L93.351,194.25h127.092L2.667,473.345L2.667,
          473.345z" />
  </g>
  <g transform="translate(246.307061, 0.255867)" opacity="0.5">
  	<path fill="currentColor"
        d="M221.334,195.155L221.334,195.155l27.559,84.815c2.514,7.735-0.24,
          16.21-6.821,20.99 L3.557,474.25L221.334,195.155L221.334,195.155z" />
  </g>
  <g transform="translate(336.973725, 280.255593)">
  	<path fill="currentColor"
        d="M130.667-84.844H3.575l54.618-168.098c2.811-8.649,15.047-8.649,
          17.856,0L130.667-84.844 L130.667-84.844z" />
  </g>
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#quassel-irc" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Philip's docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Philip's docs
              </span>
              <span class="md-header-nav__topic">
                Quassel-IRC
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://gitlab.com/shokinn/docs/" title="Go to repository" class="md-source" data-md-source="gitlab">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__gitlab" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      shokinn/docs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Philip's docs" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    Philip's docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://gitlab.com/shokinn/docs/" title="Go to repository" class="md-source" data-md-source="gitlab">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__gitlab" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      shokinn/docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Hardware
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Hardware
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Dell XPS 15 9560
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Dell XPS 15 9560
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../hardware/dell_xps_15_9560/dell_xps_15_9560_arch_linux/" title="Arch Linux" class="md-nav__link">
      Arch Linux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../playonlinux/" title="PlayOnLinux" class="md-nav__link">
      PlayOnLinux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../seedbox/" title="SeedBox" class="md-nav__link">
      SeedBox
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Knowledge base
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Knowledge base
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kb/change_tty/" title="How to change to TTYn" class="md-nav__link">
      How to change to TTYn
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../imprint/" title="Imprint" class="md-nav__link">
      Imprint
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-server-setup" title="Initial Server setup" class="md-nav__link">
    Initial Server setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-system" title="Update System" class="md-nav__link">
    Update System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-locale" title="Fix locale" class="md-nav__link">
    Fix locale
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edit-bashrc" title="Edit .bashrc" class="md-nav__link">
    Edit .bashrc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-vim-colored-with-dark-background-settinfs" title="Make vim colored with dark background settinfs" class="md-nav__link">
    Make vim colored with dark background settinfs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-user-user" title="Create a new user user" class="md-nav__link">
    Create a new user user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-the-ssh-deamon-to-allow-only-ssh-keys" title="Change the SSH deamon to allow only SSH-keys" class="md-nav__link">
    Change the SSH deamon to allow only SSH-keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-roots-authorized_keys-file" title="Delete root's authorized_keys file" class="md-nav__link">
    Delete root's authorized_keys file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-base-packages" title="Install base packages" class="md-nav__link">
    Install base packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quassel-core" title="quassel core" class="md-nav__link">
    quassel core
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-requirements" title="Pre requirements" class="md-nav__link">
    Pre requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-quassel-core" title="Install quassel core" class="md-nav__link">
    Install quassel core
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-lets-encrypt-ssl" title="Setup Let's encrypt SSL" class="md-nav__link">
    Setup Let's encrypt SSL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-automatic-certificate-renew" title="Setup automatic certificate renew" class="md-nav__link">
    Setup automatic certificate renew
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-user-management-scripts" title="Add user management scripts" class="md-nav__link">
    Add user management scripts
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-user-script" title="Add user script" class="md-nav__link">
    Add user script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backup" title="Backup" class="md-nav__link">
    Backup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-requirements_1" title="Pre requirements" class="md-nav__link">
    Pre requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup-script" title="Backup script" class="md-nav__link">
    Backup script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjob" title="Cronjob" class="md-nav__link">
    Cronjob
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" title="Security" class="md-nav__link">
    Security
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iptables" title="iptables" class="md-nav__link">
    iptables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://gitlab.com/shokinn/docs/edit/master/docs/software/quassel.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="quassel-irc">Quassel-IRC<a class="headerlink" href="#quassel-irc" title="Permanent link">&para;</a></h1>
<p>OS: Ubuntu 18.04 LTS</p>
<h2 id="initial-server-setup">Initial Server setup<a class="headerlink" href="#initial-server-setup" title="Permanent link">&para;</a></h2>
<h3 id="update-system">Update System<a class="headerlink" href="#update-system" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">apt update &amp;&amp; apt full-upgrade -y</code></pre>

<h3 id="fix-locale">Fix locale<a class="headerlink" href="#fix-locale" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF | sudo tee -a /etc/environment

# Fix locale
LC_ALL=en_US.UTF-8
LANGUAGE=en_US:en
EOF</code></pre>

<h3 id="edit-bashrc">Edit .bashrc<a class="headerlink" href="#edit-bashrc" title="Permanent link">&para;</a></h3>
<p><code>/root/.bashrc</code> / <code>/etc/skel/.bashrc</code>:<br />
<pre class="codehilite"><code># ~/.bashrc: executed by bash(1) for non-login shells.
# see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)
# for examples

# If not running interactively, don't do anything
[ -z &quot;$PS1&quot; ] &amp;&amp; return

# don't put duplicate lines in the history. See bash(1) for more options
# ... or force ignoredups and ignorespace
HISTCONTROL=ignoredups:ignorespace

# append to the history file, don't overwrite it
shopt -s histappend

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
HISTSIZE=999999
HISTFILESIZE=999999

# check the window size after each command and, if necessary,
# update the values of LINES and COLUMNS.
shopt -s checkwinsize

# make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] &amp;&amp; eval &quot;$(SHELL=/bin/sh lesspipe)&quot;

# set variable identifying the chroot you work in (used in the prompt below)
if [ -z &quot;$debian_chroot&quot; ] &amp;&amp; [ -r /etc/debian_chroot ]; then
    debian_chroot=$(cat /etc/debian_chroot)
fi

# set a fancy prompt (non-color, unless we know we &quot;want&quot; color)
case &quot;$TERM&quot; in
    xterm-color) color_prompt=yes;;
esac

# uncomment for a colored prompt, if the terminal has the capability; turned
# off by default to not distract the user: the focus in a terminal window
# should be on the output of commands, not on the prompt
force_color_prompt=yes

if [ -n &quot;$force_color_prompt&quot; ]; then
    if [ -x /usr/bin/tput ] &amp;&amp; tput setaf 1 &gt;&amp;/dev/null; then
    # We have color support; assume it's compliant with Ecma-48
    # (ISO/IEC-6429). (Lack of such support is extremely rare, and such
    # a case would tend to support setf rather than setaf.)
    color_prompt=yes
    else
    color_prompt=
    fi
fi

if [ &quot;$color_prompt&quot; = yes ]; then
    # PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
    if [ $UID == 0 ]; then
        PS1='${debian_chroot:+($debian_chroot)}\[\033[01;31m\]\u\[\033[01;33m\]@\[\033[01;36m\]\h \[\033[01;33m\]\w \[\033[01;35m\]\$ \[\033[00m\]'
    else
        PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u\[\033[01;33m\]@\[\033[01;36m\]\h \[\033[01;33m\]\w \[\033[01;35m\]\$ \[\033[00m\]'
    fi
else
    PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
fi
unset color_prompt force_color_prompt

# If this is an xterm set the title to user@host:dir
case &quot;$TERM&quot; in
xterm*|rxvt*)
    PS1=&quot;\[\e]0;${debian_chroot:+($debian_chroot)}\u@\h: \w\a\]$PS1&quot;
    ;;
*)
    ;;
esac

# enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors &amp;&amp; eval &quot;$(dircolors -b ~/.dircolors)&quot; || eval &quot;$(dircolors -b)&quot;
    alias ls='ls --color=auto'
    #alias dir='dir --color=auto'
    #alias vdir='vdir --color=auto'

    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi

# some more ls aliases
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'

# Alias definitions.
# You may want to put all your additions into a separate file like
# ~/.bash_aliases, instead of adding them here directly.
# See /usr/share/doc/bash-doc/examples in the bash-doc package.

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

# enable programmable completion features (you don't need to enable
# this, if it's already enabled in /etc/bash.bashrc and /etc/profile
# sources /etc/bash.bashrc).
#if [ -f /etc/bash_completion ] &amp;&amp; ! shopt -oq posix; then
#    . /etc/bash_completion
#fi</code></pre></p>
<h3 id="make-vim-colored-with-dark-background-settinfs">Make vim colored with dark background settinfs<a class="headerlink" href="#make-vim-colored-with-dark-background-settinfs" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF &gt;&gt; /etc/vim/vimrc

&quot; Set background to dark for better readability in SSH connections
set background=dark
EOF</code></pre>

<h3 id="create-a-new-user-user">Create a new user <code>user</code><a class="headerlink" href="#create-a-new-user-user" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">adduser user &amp;&amp; \
usermod -aG sudo user &amp;&amp; \
mkdir /home/user/.ssh &amp;&amp; \
chmod 700 /home/user/.ssh &amp;&amp; \
cp /root/.ssh/authorized_keys /home/user/.ssh/ &amp;&amp; \
chmod 400 /home/user/.ssh/authorized_keys &amp;&amp; \
chown -R user:user /home/user/.ssh/</code></pre>

<h3 id="change-the-ssh-deamon-to-allow-only-ssh-keys">Change the SSH deamon to allow only SSH-keys<a class="headerlink" href="#change-the-ssh-deamon-to-allow-only-ssh-keys" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF &gt; /etc/ssh/sshd_config &amp;&amp; systemctl restart sshd.service
# $OpenBSD: sshd_config,v 1.101 2017/03/14 07:19:07 djm Exp $

# This is the sshd server system-wide configuration file.  See
# sshd_config(5) for more information.

# This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin

# The strategy used for options in the default sshd_config shipped with
# OpenSSH is to specify options with their default value where
# possible, but leave them commented.  Uncommented options override the
# default value.

Port 22
AddressFamily any
ListenAddress 0.0.0.0
ListenAddress ::

HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

# Ciphers and keying
#RekeyLimit default none

# Logging
#SyslogFacility AUTH
#LogLevel INFO

# Authentication:

#LoginGraceTime 2m
PermitRootLogin without-password
#StrictModes yes
#MaxAuthTries 6
#MaxSessions 10

PubkeyAuthentication yes

# Expect .ssh/authorized_keys2 to be disregarded by default in future.
AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2

#AuthorizedPrincipalsFile none

#AuthorizedKeysCommand none
#AuthorizedKeysCommandUser nobody

# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
#HostbasedAuthentication no
# Change to yes if you don't trust ~/.ssh/known_hosts for
# HostbasedAuthentication
#IgnoreUserKnownHosts no
# Don't read the user's ~/.rhosts and ~/.shosts files
#IgnoreRhosts yes

# To disable tunneled clear text passwords, change to no here!
PasswordAuthentication no
PermitEmptyPasswords no

# Change to yes to enable challenge-response passwords (beware issues with
# some PAM modules and threads)
ChallengeResponseAuthentication no

# Kerberos options
#KerberosAuthentication no
#KerberosOrLocalPasswd yes
#KerberosTicketCleanup yes
#KerberosGetAFSToken no

# GSSAPI options
#GSSAPIAuthentication no
#GSSAPICleanupCredentials yes
#GSSAPIStrictAcceptorCheck yes
#GSSAPIKeyExchange no

# Set this to 'yes' to enable PAM authentication, account processing,
# and session processing. If this is enabled, PAM authentication will
# be allowed through the ChallengeResponseAuthentication and
# PasswordAuthentication.  Depending on your PAM configuration,
# PAM authentication via ChallengeResponseAuthentication may bypass
# the setting of &quot;PermitRootLogin without-password&quot;.
# If you just want the PAM account and session checks to run without
# PAM authentication, then enable this but set PasswordAuthentication
# and ChallengeResponseAuthentication to 'no'.
UsePAM yes

#AllowAgentForwarding yes
#AllowTcpForwarding yes
#GatewayPorts no
X11Forwarding yes
#X11DisplayOffset 10
#X11UseLocalhost yes
#PermitTTY yes
PrintMotd no
#PrintLastLog yes
#TCPKeepAlive yes
#UseLogin no
#PermitUserEnvironment no
#Compression delayed
#ClientAliveInterval 0
#ClientAliveCountMax 3
#UseDNS no
#PidFile /var/run/sshd.pid
#MaxStartups 10:30:100
#PermitTunnel no
#ChrootDirectory none
#VersionAddendum none

# no default banner path
#Banner none

# Allow client to pass locale environment variables
AcceptEnv LANG LC_*

# override default of no subsystems
Subsystem sftp /usr/lib/openssh/sftp-server

# Example of overriding settings on a per-user basis
#Match User anoncvs
# X11Forwarding no
# AllowTcpForwarding no
# PermitTTY no
# ForceCommand cvs server
EOF</code></pre>

<h4 id="delete-roots-authorized_keys-file">Delete root's <code>authorized_keys</code> file<a class="headerlink" href="#delete-roots-authorized_keys-file" title="Permanent link">&para;</a></h4>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please check before if you can login to the user <code>user</code> with your ssh-key!</p>
</div>
<pre class="codehilite"><code class="language-shell">rm ~/.ssh/authorized_keys</code></pre>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Log out and re login as <code>user</code>!</p>
</div>
<h3 id="install-base-packages">Install base packages<a class="headerlink" href="#install-base-packages" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">sudo apt install -y \
p7zip-full \
p7zip-rar \
unzip \
unrar \
screen \
tmux \
htop</code></pre>

<h2 id="quassel-core">quassel core<a class="headerlink" href="#quassel-core" title="Permanent link">&para;</a></h2>
<h3 id="pre-requirements">Pre requirements<a class="headerlink" href="#pre-requirements" title="Permanent link">&para;</a></h3>
<p>Add the PPA for quassel to get the latest stable version:<br />
<pre class="codehilite"><code class="language-shell">sudo add-apt-repository ppa:mamarley/quassel &amp;&amp; \
sudo apt update</code></pre></p>
<p>Install cerbot (needed for ssl):  </p>
<pre class="codehilite"><code class="language-shell">sudo apt install -y certbot</code></pre>

<h3 id="install-quassel-core">Install quassel core<a class="headerlink" href="#install-quassel-core" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">sudo apt install -y quassel-core &amp;&amp; \
systemctl status quasselcore.service</code></pre>

<h3 id="setup-lets-encrypt-ssl">Setup Let's encrypt SSL<a class="headerlink" href="#setup-lets-encrypt-ssl" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">sudo certbot certonly --standalone -d quassel.mischaufen.de &amp;&amp; \
sudo mv /var/lib/quassel/quasselCert.pem /var/lib/quassel/quasselCert.pem.old &amp;&amp; \
sudo cat /etc/letsencrypt/live/quassel.mischaufen.de/{fullchain,privkey}.pem | sudo tee -a /var/lib/quassel/quasselCert.pem &amp;&amp; \
sudo chown quasselcore:quassel /var/lib/quassel/quasselCert.pem &amp;&amp; \
sudo chmod 600 /var/lib/quassel/quasselCert.pem &amp;&amp; \
sudo systemctl restart quasselcore</code></pre>

<h3 id="setup-automatic-certificate-renew">Setup automatic certificate renew<a class="headerlink" href="#setup-automatic-certificate-renew" title="Permanent link">&para;</a></h3>
<p>Add a deploy hook script to <code>/srv/certbot</code>:<br />
<pre class="codehilite"><code class="language-shell">deamon='quasselcore.service'; \
target_domain='quassel.mischaufen.de'; \
sudo mkdir -p /srv/cerbot &amp;&amp; \
sudo chmod 655 /srv/cerbot &amp;&amp; \
cat &lt;&lt; EOF | sed 's/\\t/\t/g' | sudo tee /srv/cerbot/deploy_hook.sh &amp;&amp; \
sudo chmod 744 /srv/cerbot/deploy_hook.sh
#!/bin/bash

set -e

for domain in \$RENEWED_DOMAINS; do
\tcase \$domain in
\t$target_domain)
\t\tdaemon_cert_root='/var/lib/quassel'

\t\t# Make sure the certificate and private key files are
\t\t# never world readable, even just for an instant while
\t\t# we're copying them into daemon_cert_root.
\t\tumask 177

\t\trm \$daemon_cert_root/quasselCert.pem
\t\tcat \$RENEWED_LINEAGE/{fullchain,privkey}.pem &gt;&gt; &quot;\$daemon_cert_root/quasselCert.pem&quot;

\t\t# Apply the proper file ownership and permissions for
\t\t# the $deamon daemon to read its certificate and key.
\t\tchown quasselcore:quassel &quot;\$daemon_cert_root/quasselCert.pem&quot;
\t\tchmod 400 \$daemon_cert_root/quasselCert.pem

\t\tsystemctl restart $deamon &gt;/dev/null
\t\t;;
\tesac
done
EOF</code></pre></p>
<p>Add cronjob for renewing cetificates.</p>
<pre class="codehilite"><code class="language-shell">sudo crontab -e</code></pre>

<p>Add at the end of the file:<br />
<pre class="codehilite"><code>0 */12 * * * /usr/local/bin/certbot renew --deploy-hook /srv/cerbot/deploy_hook.sh</code></pre></p>
<h3 id="add-user-management-scripts">Add user management scripts<a class="headerlink" href="#add-user-management-scripts" title="Permanent link">&para;</a></h3>
<h4 id="add-user-script">Add user script<a class="headerlink" href="#add-user-script" title="Permanent link">&para;</a></h4>
<p><code>quassel_add.sh</code>:<br />
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF | sudo tee /usr/local/sbin/quassel_add &amp;&amp; \
sudo chmod 500 /usr/local/sbin/quassel_add
#!/bin/sh

sudo -u quasselcore quasselcore --configdir=/var/lib/quassel --add-user
EOF</code></pre></p>
<p><code>quassel_change_pw.sh</code>:<br />
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF | sudo tee /usr/local/sbin/quassel_change_pw &amp;&amp; \
sudo chmod 500 /usr/local/sbin/quassel_change_pw
#!/bin/sh

die () {
    echo &gt;&amp;2 &quot;\$@&quot;
    exit 1
}

[ &quot;\$#&quot; -eq 1 ] || die &quot;Username required!\n\nRun:\t'\$0 &lt;username&gt;'\ne.g.:\t'\$0 admin'&quot;

systemctl stop quasselcore.service
sudo -u quasselcore quasselcore --configdir=/var/lib/quassel --change-userpass=\$1
systemctl start quasselcore.service
EOF</code></pre></p>
<p><code>quassel_del.sh</code>:<br />
<pre class="codehilite"><code class="language-shell">if ! [ -x &quot;$(command -v sqlite3)&quot; ]; then sudo apt install -y sqlite3; fi &amp;&amp; \
cat &lt;&lt; EOF | sudo tee /usr/local/sbin/quassel_del &amp;&amp; \
sudo chmod 500 /usr/local/sbin/quassel_del
#!/bin/sh
#
# Delete Quasselcore users from your SQLite database
#

exeq()
{
    # Execute SQL Query
    result=\$(sqlite3 &quot;\${QUASSELDB}&quot; &quot;\${1}&quot;)
    echo &quot;\${result}&quot;
}

usage()
{
    echo &quot;Usage: \${SCRIPT} username [database]&quot;
}

print_users()
{
    sqlite3 &quot;\${QUASSELDB}&quot; &quot;SELECT quasseluser.userid, quasseluser.username FROM quasseluser ORDER BY quasseluser.userid;&quot;
}

# Main body

SCRIPT=&quot;\${0}&quot;
QUASSELDB=&quot;&quot;
USER=&quot;&quot;

if [ -z &quot;\${2}&quot; ] ; then
    # No file supplied.
    QUASSELDB=&quot;/var/lib/quassel/quassel-storage.sqlite&quot;
else
    QUASSELDB=&quot;\${2}&quot;
fi

if [ -z &quot;\${1}&quot; ] ; then
    echo &quot;No user supplied.&quot;
    echo &quot;Pick one: &quot;
    print_users
    usage
    exit 1
else
    USER=&quot;${1}&quot;
fi

if [ -e &quot;\${QUASSELDB}&quot; ] ; then
    echo &quot;SELECTED DB: \${QUASSELDB}&quot;
else
    echo &quot;SELECTED DB '\${QUASSELDB}' does not exist.&quot;
    usage
    exit 2
fi

if [ -z \$(exeq &quot;SELECT quasseluser.username FROM quasseluser WHERE username = '\${USER}';&quot;) ] ; then
    echo &quot;SELECTED USER '\${USER}' does not exist.&quot;
    print_users
    usage
    exit 3
else
    echo &quot;SELECTED USER: \${USER}&quot;
fi

# Sadly SQLITE does not allow DELETE statements that JOIN tables.
# All queries are written with a subquery.
# Contact me if you know a better way.

backlogq=&quot;DELETE
FROM backlog
WHERE backlog.bufferid in (
    SELECT bufferid
    FROM buffer, quasseluser
    WHERE buffer.userid = quasseluser.userid
    AND quasseluser.username = '\${USER}'
);&quot;

bufferq=&quot;DELETE
FROM buffer
WHERE buffer.userid in (
    SELECT userid
    FROM quasseluser
    WHERE quasseluser.username = '\${USER}'
);&quot;

ircserverq=&quot;DELETE
FROM ircserver
WHERE ircserver.userid in (
    SELECT userid
    FROM quasseluser
    WHERE quasseluser.username = '\${USER}'
);&quot;

identity_nickq=&quot;DELETE
FROM identity_nick
WHERE identity_nick.identityid in (
    SELECT identityid
    FROM quasseluser, identity
    WHERE quasseluser.userid = identity.userid
    AND quasseluser.username = '\${USER}'
);&quot;

identityq=&quot;DELETE
FROM identity
WHERE identity.userid in (
    SELECT userid
    FROM quasseluser
    WHERE quasseluser.username = '\${USER}'
);&quot;

networkq=&quot;DELETE
FROM network
WHERE network.userid in (
    SELECT userid
    FROM quasseluser
    WHERE quasseluser.username = '\${USER}'
);&quot;

usersettingq=&quot;DELETE
FROM user_setting
WHERE user_setting.userid in (
    SELECT userid
    FROM quasseluser
    WHERE quasseluser.username = '\${USER}'
);&quot;

quasseluserq=&quot;DELETE
FROM quasseluser
WHERE quasseluser.username = '\${USER}'
;&quot;


exeq &quot;\${backlogq}&quot;
exeq &quot;\${bufferq}&quot;
exeq &quot;\${ircserverq}&quot;
exeq &quot;\${identity_nickq}&quot;
exeq &quot;\${identityq}&quot;
exeq &quot;\${networkq}&quot;
exeq &quot;\${usersettingq}&quot;
exeq &quot;\${quasseluserq}&quot;
EOF</code></pre></p>
<h2 id="backup">Backup<a class="headerlink" href="#backup" title="Permanent link">&para;</a></h2>
<h3 id="pre-requirements_1">Pre requirements<a class="headerlink" href="#pre-requirements_1" title="Permanent link">&para;</a></h3>
<p>Install rclone:<br />
<pre class="codehilite"><code class="language-shell">curl https://rclone.org/install.sh | sudo bash</code></pre></p>
<p>Configure rclone:<br />
<pre class="codehilite"><code class="language-shell">sudo -H rclone config</code></pre></p>
<p>Config log:<br />
<pre class="codehilite"><code>2018/08/28 14:23:13 NOTICE: Config file &quot;/root/.config/rclone/rclone.conf&quot; not found - using defaults
No remotes found - make a new one
n) New remote
s) Set configuration password
q) Quit config
n/s/q&gt; n
name&gt; gteamdrive_quassel
Type of storage to configure.
Choose a number from below, or type in your own value
 1 / Alias for a existing remote
   \ &quot;alias&quot;
 2 / Amazon Drive
   \ &quot;amazon cloud drive&quot;
 3 / Amazon S3 Compliant Storage Providers (AWS, Ceph, Dreamhost, IBM COS, Minio)
   \ &quot;s3&quot;
 4 / Backblaze B2
   \ &quot;b2&quot;
 5 / Box
   \ &quot;box&quot;
 6 / Cache a remote
   \ &quot;cache&quot;
 7 / Dropbox
   \ &quot;dropbox&quot;
 8 / Encrypt/Decrypt a remote
   \ &quot;crypt&quot;
 9 / FTP Connection
   \ &quot;ftp&quot;
10 / Google Cloud Storage (this is not Google Drive)
   \ &quot;google cloud storage&quot;
11 / Google Drive
   \ &quot;drive&quot;
12 / Hubic
   \ &quot;hubic&quot;
13 / Local Disk
   \ &quot;local&quot;
14 / Mega
   \ &quot;mega&quot;
15 / Microsoft Azure Blob Storage
   \ &quot;azureblob&quot;
16 / Microsoft OneDrive
   \ &quot;onedrive&quot;
17 / OpenDrive
   \ &quot;opendrive&quot;
18 / Openstack Swift (Rackspace Cloud Files, Memset Memstore, OVH)
   \ &quot;swift&quot;
19 / Pcloud
   \ &quot;pcloud&quot;
20 / QingCloud Object Storage
   \ &quot;qingstor&quot;
21 / SSH/SFTP Connection
   \ &quot;sftp&quot;
22 / Webdav
   \ &quot;webdav&quot;
23 / Yandex Disk
   \ &quot;yandex&quot;
24 / http Connection
   \ &quot;http&quot;
Storage&gt; 11
Google Application Client Id - leave blank normally.
client_id&gt; ***
Google Application Client Secret - leave blank normally.
client_secret&gt; ***
Scope that rclone should use when requesting access from drive.
Choose a number from below, or type in your own value
 1 / Full access all files, excluding Application Data Folder.
   \ &quot;drive&quot;
 2 / Read-only access to file metadata and file contents.
   \ &quot;drive.readonly&quot;
   / Access to files created by rclone only.
 3 | These are visible in the drive website.
   | File authorization is revoked when the user deauthorizes the app.
   \ &quot;drive.file&quot;
   / Allows read and write access to the Application Data folder.
 4 | This is not visible in the drive website.
   \ &quot;drive.appfolder&quot;
   / Allows read-only access to file metadata but
 5 | does not allow any access to read or download file content.
   \ &quot;drive.metadata.readonly&quot;
scope&gt; 1
ID of the root folder - leave blank normally.  Fill in to access &quot;Computers&quot; folders. (see docs).
root_folder_id&gt;
Service Account Credentials JSON file path  - leave blank normally.
Needed only if you want use SA instead of interactive login.
service_account_file&gt;
Remote config
Use auto config?
 * Say Y if not sure
 * Say N if you are working on a remote or headless machine or Y didn't work
y) Yes
n) No
y/n&gt; n
If your browser doesn't open automatically go to the following link: https://accounts.google.com/o/oauth2/auth?access_type=offline&amp;client_id=***
Log in and authorize rclone for access
Enter verification code&gt; ***
Configure this as a team drive?
y) Yes
n) No
y/n&gt; y
Fetching team drive list...
Choose a number from below, or type in your own value
 1 / ***
   \ &quot;***&quot;
 2 / ***
   \ &quot;***&quot;
 3 / quassel
   \ &quot;***&quot;
Enter a Team Drive ID&gt; 3
--------------------
[gteamdrive_quassel]
type = drive
client_id = ***
client_secret = ***
scope = drive
root_folder_id =
service_account_file =
token = ***
team_drive = &lt;drive id from quassel&gt;
--------------------
y) Yes this is OK
e) Edit this remote
d) Delete this remote
y/e/d&gt; y
Current remotes:

Name                 Type
====                 ====
gteamdrive_quassel   drive

e) Edit existing remote
n) New remote
d) Delete remote
r) Rename remote
c) Copy remote
s) Set configuration password
q) Quit config
e/n/d/r/c/s/q&gt; n
name&gt; quassel_crypt
Type of storage to configure.
Choose a number from below, or type in your own value
 1 / Alias for a existing remote
   \ &quot;alias&quot;
 2 / Amazon Drive
   \ &quot;amazon cloud drive&quot;
 3 / Amazon S3 Compliant Storage Providers (AWS, Ceph, Dreamhost, IBM COS, Minio)
   \ &quot;s3&quot;
 4 / Backblaze B2
   \ &quot;b2&quot;
 5 / Box
   \ &quot;box&quot;
 6 / Cache a remote
   \ &quot;cache&quot;
 7 / Dropbox
   \ &quot;dropbox&quot;
 8 / Encrypt/Decrypt a remote
   \ &quot;crypt&quot;
 9 / FTP Connection
   \ &quot;ftp&quot;
10 / Google Cloud Storage (this is not Google Drive)
   \ &quot;google cloud storage&quot;
11 / Google Drive
   \ &quot;drive&quot;
12 / Hubic
   \ &quot;hubic&quot;
13 / Local Disk
   \ &quot;local&quot;
14 / Mega
   \ &quot;mega&quot;
15 / Microsoft Azure Blob Storage
   \ &quot;azureblob&quot;
16 / Microsoft OneDrive
   \ &quot;onedrive&quot;
17 / OpenDrive
   \ &quot;opendrive&quot;
18 / Openstack Swift (Rackspace Cloud Files, Memset Memstore, OVH)
   \ &quot;swift&quot;
19 / Pcloud
   \ &quot;pcloud&quot;
20 / QingCloud Object Storage
   \ &quot;qingstor&quot;
21 / SSH/SFTP Connection
   \ &quot;sftp&quot;
22 / Webdav
   \ &quot;webdav&quot;
23 / Yandex Disk
   \ &quot;yandex&quot;
24 / http Connection
   \ &quot;http&quot;
Storage&gt; 8
Remote to encrypt/decrypt.
Normally should contain a ':' and a path, eg &quot;myremote:path/to/dir&quot;,
&quot;myremote:bucket&quot; or maybe &quot;myremote:&quot; (not recommended).
remote&gt; gteamdrive_quassel:/
How to encrypt the filenames.
Choose a number from below, or type in your own value
 1 / Don't encrypt the file names.  Adds a &quot;.bin&quot; extension only.
   \ &quot;off&quot;
 2 / Encrypt the filenames see the docs for the details.
   \ &quot;standard&quot;
 3 / Very simple filename obfuscation.
   \ &quot;obfuscate&quot;
filename_encryption&gt; 2
Option to either encrypt directory names or leave them intact.
Choose a number from below, or type in your own value
 1 / Encrypt directory names.
   \ &quot;true&quot;
 2 / Don't encrypt directory names, leave them intact.
   \ &quot;false&quot;
directory_name_encryption&gt; 1
Password or pass phrase for encryption.
y) Yes type in my own password
g) Generate random password
y/g&gt; g
Password strength in bits.
64 is just about memorable
128 is secure
1024 is the maximum
Bits&gt; 1024
Your password is: ***
Use this password?
y) Yes
n) No
y/n&gt; y
Password or pass phrase for salt. Optional but recommended.
Should be different to the previous password.
y) Yes type in my own password
g) Generate random password
n) No leave this optional password blank
y/g/n&gt; g
Password strength in bits.
64 is just about memorable
128 is secure
1024 is the maximum
Bits&gt; 1024
Your password is: ***
Use this password?
y) Yes
n) No
y/n&gt; y
Remote config
--------------------
[quassel_crypt]
type = crypt
remote = gteamdrive_quassel:/
filename_encryption = standard
directory_name_encryption = true
password = *** ENCRYPTED ***
password2 = *** ENCRYPTED ***
--------------------
y) Yes this is OK
e) Edit this remote
d) Delete this remote
y/e/d&gt; y
Current remotes:

Name                 Type
====                 ====
gteamdrive_quassel   drive
quassel_crypt        crypt

e) Edit existing remote
n) New remote
d) Delete remote
r) Rename remote
c) Copy remote
s) Set configuration password
q) Quit config
e/n/d/r/c/s/q&gt; q</code></pre></p>
<h3 id="backup-script">Backup script<a class="headerlink" href="#backup-script" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF | sudo tee /usr/local/sbin/quassel_backup &amp;&amp; \
sudo chmod 500 /usr/local/sbin/quassel_backup
#!/bin/bash

user='quasselcore'
database='/var/lib/quassel/quassel-storage.sqlite'
backup_target='/tmp'
backup_name='quassel'
date=\$(date +&quot;%Y-%m-%d_%H:%m&quot;)

# Backup database
sudo -u \${user} sqlite3 \${database} &quot;.backup \${backup_target}/\${backup_name}_\${date}.sqlite&quot;

# Upload database to google
rclone copy \${backup_target}/\${backup_name}_\${date}.sqlite quassel_crypt:

# remove local backup file
rm \${backup_target}/\${backup_name}_\${date}.sqlite
EOF</code></pre>

<h3 id="cronjob">Cronjob<a class="headerlink" href="#cronjob" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">sudo crontab -e</code></pre>

<p>Add at the end of the file:<br />
<pre class="codehilite"><code>@hourly /usr/local/sbin/quassel_backup</code></pre></p>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<h3 id="iptables">iptables<a class="headerlink" href="#iptables" title="Permanent link">&para;</a></h3>
<details class="tip"><summary>Explanation iptables rules</summary><pre class="codehilite"><code class="language-shell"># Allow loopback
iptables -A OUTPUT -o lo -j ACCEPT
iptables -A INPUT -i lo -j ACCEPT

# Allow SSH incoming
iptables -t filter -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT

# Allow quassel incoming
iptables -t filter -A INPUT -i eth0 -p tcp --dport 4242 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT

# Allow ESTABLISHED and RELATED connection (important for outgoing connections!)
iptables -t filter -A INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT

# Policy DROP INPUT on
iptables -P INPUT DROP;

# Policy ACCEPT OUTPUT
iptables -P OUTPUT ACCEPT</code></pre>

</details>
<p>Set up needed iptables rules:<br />
<pre class="codehilite"><code class="language-shell">sudo iptables -A OUTPUT -o lo -j ACCEPT; \
sudo iptables -A INPUT -i lo -j ACCEPT; \
sudo iptables -t filter -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT; \
sudo iptables -t filter -A INPUT -i eth0 -p tcp --dport 4242 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT; \
sudo iptables -t filter -A INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT; \
sudo iptables -t filter -A INPUT -i eth0 -p icmp -j ACCEPT; \
sudo iptables -P INPUT DROP; \
sudo iptables -P OUTPUT ACCEPT</code></pre>
Set up needed ip6tables rules:<br />
<pre class="codehilite"><code class="language-shell">sudo ip6tables -A OUTPUT -o lo -j ACCEPT; \
sudo ip6tables -A INPUT -i lo -j ACCEPT; \
sudo ip6tables -t filter -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT; \
sudo ip6tables -t filter -A INPUT -i eth0 -p tcp --dport 4242 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT; \
sudo ip6tables -t filter -A INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT; \
sudo ip6tables -t filter -A INPUT -i eth0 -p ipv6-icmp -j ACCEPT; \
sudo ip6tables -P INPUT DROP; \
sudo ip6tables -P OUTPUT ACCEPT</code></pre></p>
<p>Persist iptables rules:<br />
<pre class="codehilite"><code class="language-shell">sudo apt install -y iptables-persistent &amp;&amp; \
sudo netfilter-persistent save &amp;&amp; \
sudo netfilter-persistent reload</code></pre></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="http://pphg.tech" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://keybase.io/philip_henning" class="md-footer-social__link fa fa-key"></a>
    
      <a href="https://twitter.com/__phg" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/shokinn" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://gitlab.com/shokinn" class="md-footer-social__link fa fa-gitlab"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../search/main.js"></script>
      
    
    
      
    
  </body>
</html>