



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Everything which I have to write down to remember it">
      
      
      
        <meta name="author" content="Philip Henning">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../..">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Concourse dockerized - Philip's docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="500" height="500"
    viewBox="0 0 500 500" id="__gitlab">
  <g transform="translate(156.197863, 1.160267)">
  	<path fill="currentColor"
        d="M93.667,473.347L93.667,473.347l90.684-279.097H2.983L93.667,
          473.347L93.667,473.347z" />
  </g>
  <g transform="translate(28.531199, 1.160800)" opacity="0.7">
  	<path fill="currentColor"
        d="M221.333,473.345L130.649,194.25H3.557L221.333,473.345L221.333,
          473.345z" />
  </g>
  <g transform="translate(0.088533, 0.255867)" opacity="0.5">
  	<path fill="currentColor"
        d="M32,195.155L32,195.155L4.441,279.97c-2.513,7.735,0.24,16.21,6.821,
          20.99l238.514,173.29 L32,195.155L32,195.155z" />
  </g>
  <g transform="translate(29.421866, 280.255593)">
  	<path fill="currentColor"
        d="M2.667-84.844h127.092L75.14-252.942c-2.811-8.649-15.047-8.649-17.856,
          0L2.667-84.844 L2.667-84.844z" />
  </g>
  <g transform="translate(247.197860, 1.160800)" opacity="0.7">
  	<path fill="currentColor"
        d="M2.667,473.345L93.351,194.25h127.092L2.667,473.345L2.667,
          473.345z" />
  </g>
  <g transform="translate(246.307061, 0.255867)" opacity="0.5">
  	<path fill="currentColor"
        d="M221.334,195.155L221.334,195.155l27.559,84.815c2.514,7.735-0.24,
          16.21-6.821,20.99 L3.557,474.25L221.334,195.155L221.334,195.155z" />
  </g>
  <g transform="translate(336.973725, 280.255593)">
  	<path fill="currentColor"
        d="M130.667-84.844H3.575l54.618-168.098c2.811-8.649,15.047-8.649,
          17.856,0L130.667-84.844 L130.667-84.844z" />
  </g>
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#concourse-dockerized" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Philip's docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Philip's docs
              </span>
              <span class="md-header-nav__topic">
                Concourse dockerized
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://gitlab.com/shokinn/docs/" title="Go to repository" class="md-source" data-md-source="gitlab">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__gitlab" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      shokinn/docs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Philip's docs" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    Philip's docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://gitlab.com/shokinn/docs/" title="Go to repository" class="md-source" data-md-source="gitlab">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__gitlab" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      shokinn/docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Hardware
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Hardware
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Dell XPS 15 9560
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Dell XPS 15 9560
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../hardware/dell_xps_15_9560/dell_xps_15_9560_arch_linux/" title="Arch Linux" class="md-nav__link">
      Arch Linux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../playonlinux/" title="PlayOnLinux" class="md-nav__link">
      PlayOnLinux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../seedbox/" title="SeedBox" class="md-nav__link">
      SeedBox
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Knowledge base
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Knowledge base
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kb/change_tty/" title="How to change to TTYn" class="md-nav__link">
      How to change to TTYn
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../imprint/" title="Impressum" class="md-nav__link">
      Impressum
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../datenschutzerklaerung/" title="Datenschutzerklärung" class="md-nav__link">
      Datenschutzerklärung
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-server-setup" title="Initial Server setup" class="md-nav__link">
    Initial Server setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-system" title="Update System" class="md-nav__link">
    Update System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-vim-colored-with-dark-background-settings" title="Make vim colored with dark background settings" class="md-nav__link">
    Make vim colored with dark background settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-locale" title="Fix locale" class="md-nav__link">
    Fix locale
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#edit-bashrc" title="Edit .bashrc" class="md-nav__link">
    Edit .bashrc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-user-user" title="Create a new user user" class="md-nav__link">
    Create a new user user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-the-ssh-deamon-to-allow-only-ssh-keys" title="Change the SSH deamon to allow only SSH-keys" class="md-nav__link">
    Change the SSH deamon to allow only SSH-keys
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-roots-authorized_keys-file" title="Delete root's authorized_keys file" class="md-nav__link">
    Delete root's authorized_keys file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-base-packages" title="Install base packages" class="md-nav__link">
    Install base packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker" title="Docker" class="md-nav__link">
    Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-requirements" title="Pre-requirements" class="md-nav__link">
    Pre-requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-docker" title="Install Docker" class="md-nav__link">
    Install Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-docker-network-for-concourse" title="Create a new docker network for concourse" class="md-nav__link">
    Create a new docker network for concourse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-portainer" title="Install Portainer" class="md-nav__link">
    Install Portainer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql" title="PostgreSQL" class="md-nav__link">
    PostgreSQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup" title="Backup" class="md-nav__link">
    Backup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://gitlab.com/shokinn/docs/edit/master/docs/software/concourse_dockerized.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="concourse-dockerized">Concourse dockerized<a class="headerlink" href="#concourse-dockerized" title="Permanent link">&para;</a></h1>
<p>OS: Ubuntu 18.04 LTS (Bionic Beaver)</p>
<h2 id="initial-server-setup">Initial Server setup<a class="headerlink" href="#initial-server-setup" title="Permanent link">&para;</a></h2>
<h3 id="update-system">Update System<a class="headerlink" href="#update-system" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">apt update &amp;&amp; apt full-upgrade -y</code></pre>

<h3 id="make-vim-colored-with-dark-background-settings">Make vim colored with dark background settings<a class="headerlink" href="#make-vim-colored-with-dark-background-settings" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF &gt;&gt; /etc/vim/vimrc

&quot; Set background to dark for better readability in SSH connections
set background=dark
EOF</code></pre>

<h3 id="fix-locale">Fix locale<a class="headerlink" href="#fix-locale" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF | sudo tee -a /etc/environment

# Fix locale
LC_ALL=en_US.UTF-8
LANGUAGE=en_US:en
EOF</code></pre>

<h3 id="edit-bashrc">Edit .bashrc<a class="headerlink" href="#edit-bashrc" title="Permanent link">&para;</a></h3>
<p><code>/root/.bashrc</code> / <code>/etc/skel/.bashrc</code>:<br />
<pre class="codehilite"><code># ~/.bashrc: executed by bash(1) for non-login shells.
# see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)
# for examples

# If not running interactively, don't do anything
[ -z &quot;$PS1&quot; ] &amp;&amp; return

# don't put duplicate lines in the history. See bash(1) for more options
# ... or force ignoredups and ignorespace
HISTCONTROL=ignoredups:ignorespace

# append to the history file, don't overwrite it
shopt -s histappend

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
HISTSIZE=999999
HISTFILESIZE=999999

# check the window size after each command and, if necessary,
# update the values of LINES and COLUMNS.
shopt -s checkwinsize

# make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] &amp;&amp; eval &quot;$(SHELL=/bin/sh lesspipe)&quot;

# set variable identifying the chroot you work in (used in the prompt below)
if [ -z &quot;$debian_chroot&quot; ] &amp;&amp; [ -r /etc/debian_chroot ]; then
    debian_chroot=$(cat /etc/debian_chroot)
fi

# set a fancy prompt (non-color, unless we know we &quot;want&quot; color)
case &quot;$TERM&quot; in
    xterm-color) color_prompt=yes;;
esac

# uncomment for a colored prompt, if the terminal has the capability; turned
# off by default to not distract the user: the focus in a terminal window
# should be on the output of commands, not on the prompt
force_color_prompt=yes

if [ -n &quot;$force_color_prompt&quot; ]; then
    if [ -x /usr/bin/tput ] &amp;&amp; tput setaf 1 &gt;&amp;/dev/null; then
    # We have color support; assume it's compliant with Ecma-48
    # (ISO/IEC-6429). (Lack of such support is extremely rare, and such
    # a case would tend to support setf rather than setaf.)
    color_prompt=yes
    else
    color_prompt=
    fi
fi

if [ &quot;$color_prompt&quot; = yes ]; then
    # PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
    if [ $UID == 0 ]; then
        PS1='${debian_chroot:+($debian_chroot)}\[\033[01;31m\]\u\[\033[01;33m\]@\[\033[01;36m\]\h \[\033[01;33m\]\w \[\033[01;35m\]\$ \[\033[00m\]'
    else
        PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u\[\033[01;33m\]@\[\033[01;36m\]\h \[\033[01;33m\]\w \[\033[01;35m\]\$ \[\033[00m\]'
    fi
else
    PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
fi
unset color_prompt force_color_prompt

# If this is an xterm set the title to user@host:dir
case &quot;$TERM&quot; in
xterm*|rxvt*)
    PS1=&quot;\[\e]0;${debian_chroot:+($debian_chroot)}\u@\h: \w\a\]$PS1&quot;
    ;;
*)
    ;;
esac

# enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors &amp;&amp; eval &quot;$(dircolors -b ~/.dircolors)&quot; || eval &quot;$(dircolors -b)&quot;
    alias ls='ls --color=auto'
    #alias dir='dir --color=auto'
    #alias vdir='vdir --color=auto'

    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi

# some more ls aliases
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'

# Alias definitions.
# You may want to put all your additions into a separate file like
# ~/.bash_aliases, instead of adding them here directly.
# See /usr/share/doc/bash-doc/examples in the bash-doc package.

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

# enable programmable completion features (you don't need to enable
# this, if it's already enabled in /etc/bash.bashrc and /etc/profile
# sources /etc/bash.bashrc).
#if [ -f /etc/bash_completion ] &amp;&amp; ! shopt -oq posix; then
#    . /etc/bash_completion
#fi</code></pre></p>
<h3 id="create-a-new-user-user">Create a new user <code>user</code><a class="headerlink" href="#create-a-new-user-user" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">adduser user &amp;&amp; \
usermod -aG sudo user &amp;&amp; \
mkdir /home/user/.ssh &amp;&amp; \
chmod 700 /home/user/.ssh &amp;&amp; \
cp /root/.ssh/authorized_keys /home/user/.ssh/ &amp;&amp; \
chmod 400 /home/user/.ssh/authorized_keys &amp;&amp; \
chown -R user:user /home/user/.ssh/</code></pre>

<h3 id="change-the-ssh-deamon-to-allow-only-ssh-keys">Change the SSH deamon to allow only SSH-keys<a class="headerlink" href="#change-the-ssh-deamon-to-allow-only-ssh-keys" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF &gt; /etc/ssh/sshd_config &amp;&amp; systemctl restart sshd.service
#   $OpenBSD: sshd_config,v 1.101 2017/03/14 07:19:07 djm Exp $

# This is the sshd server system-wide configuration file.  See
# sshd_config(5) for more information.

# This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin

# The strategy used for options in the default sshd_config shipped with
# OpenSSH is to specify options with their default value where
# possible, but leave them commented.  Uncommented options override the
# default value.

Port 22
AddressFamily any
ListenAddress 0.0.0.0
ListenAddress ::

HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

# Ciphers and keying
#RekeyLimit default none

# Logging
#SyslogFacility AUTH
#LogLevel INFO

# Authentication:

#LoginGraceTime 2m
PermitRootLogin without-password
#StrictModes yes
#MaxAuthTries 6
#MaxSessions 10

PubkeyAuthentication yes

# Expect .ssh/authorized_keys2 to be disregarded by default in future.
AuthorizedKeysFile  .ssh/authorized_keys .ssh/authorized_keys2

#AuthorizedPrincipalsFile none

#AuthorizedKeysCommand none
#AuthorizedKeysCommandUser nobody

# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
#HostbasedAuthentication no
# Change to yes if you don't trust ~/.ssh/known_hosts for
# HostbasedAuthentication
#IgnoreUserKnownHosts no
# Don't read the user's ~/.rhosts and ~/.shosts files
#IgnoreRhosts yes

# To disable tunneled clear text passwords, change to no here!
PasswordAuthentication no
PermitEmptyPasswords no

# Change to yes to enable challenge-response passwords (beware issues with
# some PAM modules and threads)
ChallengeResponseAuthentication no

# Kerberos options
#KerberosAuthentication no
#KerberosOrLocalPasswd yes
#KerberosTicketCleanup yes
#KerberosGetAFSToken no

# GSSAPI options
#GSSAPIAuthentication no
#GSSAPICleanupCredentials yes
#GSSAPIStrictAcceptorCheck yes
#GSSAPIKeyExchange no

# Set this to 'yes' to enable PAM authentication, account processing,
# and session processing. If this is enabled, PAM authentication will
# be allowed through the ChallengeResponseAuthentication and
# PasswordAuthentication.  Depending on your PAM configuration,
# PAM authentication via ChallengeResponseAuthentication may bypass
# the setting of &quot;PermitRootLogin without-password&quot;.
# If you just want the PAM account and session checks to run without
# PAM authentication, then enable this but set PasswordAuthentication
# and ChallengeResponseAuthentication to 'no'.
UsePAM yes

#AllowAgentForwarding yes
#AllowTcpForwarding yes
#GatewayPorts no
X11Forwarding yes
#X11DisplayOffset 10
#X11UseLocalhost yes
#PermitTTY yes
PrintMotd no
#PrintLastLog yes
#TCPKeepAlive yes
#UseLogin no
#PermitUserEnvironment no
#Compression delayed
#ClientAliveInterval 0
#ClientAliveCountMax 3
#UseDNS no
#PidFile /var/run/sshd.pid
#MaxStartups 10:30:100
#PermitTunnel no
#ChrootDirectory none
#VersionAddendum none

# no default banner path
#Banner none

# Allow client to pass locale environment variables
AcceptEnv LANG LC_*

# override default of no subsystems
Subsystem   sftp    /usr/lib/openssh/sftp-server

# Example of overriding settings on a per-user basis
#Match User anoncvs
#   X11Forwarding no
#   AllowTcpForwarding no
#   PermitTTY no
#   ForceCommand cvs server
EOF</code></pre>

<h4 id="delete-roots-authorized_keys-file">Delete root's <code>authorized_keys</code> file<a class="headerlink" href="#delete-roots-authorized_keys-file" title="Permanent link">&para;</a></h4>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please check before if you can login to the user <code>user</code> with your ssh-key!</p>
</div>
<pre class="codehilite"><code class="language-shell">rm ~/.ssh/authorized_keys</code></pre>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Log out and re login as <code>user</code>!</p>
</div>
<h3 id="install-base-packages">Install base packages<a class="headerlink" href="#install-base-packages" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">sudo apt install -y \
p7zip-full \
p7zip-rar \
zip \
unzip \
unrar \
screen \
tmux \
htop</code></pre>

<h2 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h2>
<h3 id="pre-requirements">Pre-requirements<a class="headerlink" href="#pre-requirements" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">sudo apt install -y apt-transport-https ca-certificates curl software-properties-common</code></pre>

<h3 id="install-docker">Install Docker<a class="headerlink" href="#install-docker" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">The following steps are shortened!</p>
<p>Here is the full Guide to install docker on Ubuntu 18.04 (Bionic Beaver)<br />
<a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-18-04">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-18-04</a></p>
</div>
<pre class="codehilite"><code class="language-shell">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - &amp;&amp; \
sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable&quot; &amp;&amp; \
sudo apt update &amp;&amp; \
apt-cache policy docker-ce &amp;&amp; \
echo &quot;Verify that docker-ce will be installed from the docker repository instead of the ubuntu repo.&quot; &amp;&amp; \
read -p &quot;Press any key to continue or press CTRL-C to abort... &quot; -n1 -s &amp;&amp; \
sudo apt install -y docker-ce &amp;&amp; \
sudo systemctl status docker</code></pre>

<h3 id="create-a-new-docker-network-for-concourse">Create a new docker network for concourse<a class="headerlink" href="#create-a-new-docker-network-for-concourse" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">sudo docker network create \
  -d bridge \
  -o &quot;com.docker.network.bridge.name&quot;=&quot;docker1&quot; \
  -o &quot;com.docker.network.bridge.enable_ip_masquerade&quot;=true \
  -o &quot;com.docker.network.bridge.enable_icc&quot;=true \
  -o &quot;com.docker.network.bridge.host_binding_ipv4&quot;=&quot;0.0.0.0&quot; \
  -o &quot;com.docker.network.driver.mtu&quot;=&quot;1500&quot; \
  --scope=local \
  --subnet=172.23.0.0/16 \
  --ip-range=172.23.42.0/24 \
  --gateway=172.23.0.1 \
  concourse_net</code></pre>

<h3 id="install-portainer">Install Portainer<a class="headerlink" href="#install-portainer" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">sudo docker volume create portainer_data &amp;&amp; \
sudo docker run \
  --name portainer \
  --volume /var/run/docker.sock:/var/run/docker.sock \
  --volume portainer_data:/data \
  --network concourse_net \
  --ip 172.23.0.10 \
  --restart unless-stopped \
  --detach \
  portainer/portainer</code></pre>

<h2 id="postgresql">PostgreSQL<a class="headerlink" href="#postgresql" title="Permanent link">&para;</a></h2>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">PSQL_CONCOURSE_USER=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 1) &amp;&amp; \
PSQL_CONCOURSE_PW=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 1) &amp;&amp; \
sudo docker volume create pgdata &amp;&amp; \
sudo docker run \
  --name concourse-db \
  --volume pgdata:/var/lib/postgresql/data \
  --network concourse_net \
  --hostname concourse-db \
  --ip 172.23.1.10 \
  --restart unless-stopped \
  --env POSTGRES_USER=$PSQL_CONCOURSE_USER \
  --env POSTGRES_PASSWORD=$PSQL_CONCOURSE_PW \
  --env POSTGRES_DB=atc \
  --detach \
  postgres:10.4-alpine &amp;&amp; \
echo -e &quot;User:\t\t$PSQL_CONCOURSE_USER&quot;; \
echo -e &quot;Password:\t$PSQL_CONCOURSE_PW&quot;</code></pre>

<h3 id="backup">Backup<a class="headerlink" href="#backup" title="Permanent link">&para;</a></h3>
<h1 id="todo">TODO<a class="headerlink" href="#todo" title="Permanent link">&para;</a></h1>
<h2 id="concourse">Concourse<a class="headerlink" href="#concourse" title="Permanent link">&para;</a></h2>
<h3 id="pre-requirements_1">Pre-requirements<a class="headerlink" href="#pre-requirements_1" title="Permanent link">&para;</a></h3>
<p>Create a GitHub OAuth app for authentication:</p>
<p>Follow this Guide:<br />
<a href="https://concourse-ci.org/install.html#github-auth-config">https://concourse-ci.org/install.html#github-auth-config</a></p>
<h3 id="install-web-interface">Install Web interface<a class="headerlink" href="#install-web-interface" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">echo &quot;&quot; &amp;&amp; \
read -p &quot;Enter your GitHub client ID: &quot; GITHUB_CLIENT_ID &amp;&amp; \
while true; do \
set GITHUB_CLIENT_SECRET=&quot;&quot;; \
set GITHUB_CLIENT_SECRET_confirm=&quot;&quot;; \
read -s -p &quot;Enter your GitHub client secret: &quot; GITHUB_CLIENT_SECRET; echo &quot;&quot;; \
read -s -p &quot;Reenter your GitHub client secret: &quot; GITHUB_CLIENT_SECRET_confirm; echo &quot;&quot;; \
if [[ &quot;$GITHUB_CLIENT_SECRET&quot; == &quot;$GITHUB_CLIENT_SECRET_confirm&quot; ]]; then \
break; \
else \
clear; \
echo &quot;Your secrets don't match! Please try again.&quot;; \
echo &quot;&quot;; \
fi; \
done; \
CONCOURSE_ADMIN_USER=admin &amp;&amp; \
CONCOURSE_ADMIN_PW=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 1) &amp;&amp; \
CONCOUSE_WEB_IP='172.23.1.11' &amp;&amp; \
ORG_NAME=&quot;mischaufen&quot; &amp;&amp; \
TEAM_NAME=&quot;main&quot; &amp;&amp; \
sudo docker volume create concourse-keys &amp;&amp; \
sudo ssh-keygen -t rsa -q -N '' -f  /var/lib/docker/volumes/concourse-keys/_data/tsa_host_key &amp;&amp; \
sudo chmod 600 /var/lib/docker/volumes/concourse-keys/_data/tsa_host_key &amp;&amp; \
sudo touch /var/lib/docker/volumes/concourse-keys/_data/authorized_worker_keys &amp;&amp; \
sudo chmod 600 /var/lib/docker/volumes/concourse-keys/_data/authorized_worker_keys &amp;&amp; \
sudo ssh-keygen -t rsa -q -N '' -f /var/lib/docker/volumes/concourse-keys/_data/worker_key &amp;&amp; \
sudo chmod 600 /var/lib/docker/volumes/concourse-keys/_data/worker_key &amp;&amp; \
sudo cat /var/lib/docker/volumes/concourse-keys/_data/worker_key.pub | sudo tee -a /var/lib/docker/volumes/concourse-keys/_data/authorized_worker_keys &amp;&amp; \
sudo ssh-keygen -t rsa -q -N '' -f /var/lib/docker/volumes/concourse-keys/_data/session_signing_key &amp;&amp; \
sudo chmod 600 /var/lib/docker/volumes/concourse-keys/_data/session_signing_key &amp;&amp; \
sudo docker run \
  --name concourse-web \
  --volume concourse-keys:/concourse-keys \
  --network concourse_net \
  --hostname concourse-web \
  --ip $CONCOUSE_WEB_IP \
  --privileged \
  --restart unless-stopped \
  --detach \
  concourse/concourse:4.2.1 web \
  --tsa-host-key='/concourse-keys/tsa_host_key' \
  --tsa-authorized-keys='/concourse-keys/authorized_worker_keys' \
  --tsa-session-signing-key='/concourse-keys/session_signing_key' \
  --add-local-user=$CONCOURSE_ADMIN_USER:$CONCOURSE_ADMIN_PW \
  --main-team-local-user=$CONCOURSE_ADMIN_USER \
  --github-client-id=$GITHUB_CLIENT_ID \
  --github-client-secret=$GITHUB_CLIENT_SECRET \
  --main-team-github-team=$ORG_NAME:$TEAM_NAME \
  --postgres-user=$PSQL_CONCOURSE_USER \
  --postgres-password=$PSQL_CONCOURSE_PW \
  --postgres-host=$(sudo docker inspect -f &quot;{{ .NetworkSettings.Networks.concourse_net.IPAddress }}&quot; concourse-db) \
  --postgres-port=5432 \
  --bind-ip=$CONCOUSE_WEB_IP \
  --external-url='https://ci.mischaufen.de' &amp;&amp; \
echo -e &quot;User:\t\t$CONCOURSE_ADMIN_USER&quot;; \
echo -e &quot;Password:\t$CONCOURSE_ADMIN_PW&quot;</code></pre>

<h3 id="install-worker">Install worker<a class="headerlink" href="#install-worker" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">CONCOURSE_WORKER_IP=172.23.1.12 &amp;&amp; \
sudo docker run \
  --name concourse-worker \
  --volume concourse-keys:/concourse-keys \
  --network concourse_net \
  --hostname concourse-worker \
  --ip $CONCOURSE_WORKER_IP \
  --privileged \
  --restart unless-stopped \
  --detach \
  concourse/concourse:4.2.1 worker \
  --tsa-host=$(sudo docker inspect -f &quot;{{ .NetworkSettings.Networks.concourse_net.IPAddress }}&quot; concourse-web):2222 \
  --garden-dns-server=1.1.1.1 \
  --garden-dns-proxy-enable</code></pre>

<h2 id="fly">fly<a class="headerlink" href="#fly" title="Permanent link">&para;</a></h2>
<h3 id="install-fly">Install fly<a class="headerlink" href="#install-fly" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-shell">sudo wget -O /root/fly_updater.sh https://gist.githubusercontent.com/shokinn/9eb8b9e39e8a73e4ad085cd9c75a3b4f/raw/3c3b29cc08c927bdd60253050b248d9e9f33d67d/fly_updater.sh &amp;&amp; \
sudo chmod u+x /root/fly_updater.sh &amp;&amp; \
sudo /root/fly_updater.sh</code></pre>

<h3 id="configure">Configure<a class="headerlink" href="#configure" title="Permanent link">&para;</a></h3>
<p>First, let's check that we can access the Concourse service with the <code>fly</code> command line client.</p>
<p>We have to log in using the administrative username and password that we configured in the <code>/etc/concourse/web_environment</code> file using the <code>login</code> subcommand. A single <code>fly</code> binary can be used to contact and manage multiple Concourse servers, so the command uses a concept called "targets" as an alias for different servers. We will call our target "local" to log into the local Concourse server:<br />
<pre class="codehilite"><code class="language-shell">fly -t local login -c http://$(sudo docker inspect -f &quot;{{ .NetworkSettings.Networks.concourse_net.IPAddress }}&quot; concourse-web):8080</code></pre></p>
<p>You will be prompted for going to <code>http://172.23.1.11:8080/sky/login?redirect_uri=http://127.0.0.1:33277/auth/callback</code>. Do the following instead:</p>
<p>Add a port forwarding (on your local PC) from <code>8080</code> to <code>172.23.1.11:8080</code> and go to:<br />
<a href="http://127.0.0.1:8080/sky/login?redirect_uri=http://127.0.0.1:8080/sky/token">http://127.0.0.1:8080/sky/login?redirect_uri=http://127.0.0.1:8080/sky/token</a></p>
<p>Now copy/paste the token to your promt.</p>
<p>This indicates that we were able to log in successfully. While we are here, let's verify that the worker process was able to successfully register to the TSA component by typing:<br />
<pre class="codehilite"><code class="language-shell">fly -t local workers</code></pre></p>
<p>Output:<br />
<pre class="codehilite"><code>name              containers  platform  tags  team  state    version
concourse-server  0           linux     none  none  running  2.1</code></pre></p>
<p>The <code>fly</code> command is used to configure pipelines and manage the Concourse CI service. The <code>fly help</code> command provides information about additional commands.</p>
<h2 id="nginx">Nginx<a class="headerlink" href="#nginx" title="Permanent link">&para;</a></h2>
<h3 id="install_1">Install<a class="headerlink" href="#install_1" title="Permanent link">&para;</a></h3>
<p>Install all needed Packages for nginx tasks: 
<pre class="codehilite"><code class="language-shell">sudo apt update &amp;&amp; \
sudo apt install -y \
nginx \
python3-pip &amp;&amp; \
sudo -H pip3 install --system --upgrade \
pip &amp;&amp; \
sudo -H pip3 install --upgrade \
setuptools &amp;&amp; \
sudo -H pip3 install --upgrade \
cryptography &amp;&amp; \
sudo -H pip3 install \
certbot \
certbot-nginx</code></pre></p>
<h3 id="configure_1">Configure<a class="headerlink" href="#configure_1" title="Permanent link">&para;</a></h3>
<h4 id="delete-default-entry">Delete default entry<a class="headerlink" href="#delete-default-entry" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-shell">sudo rm /etc/nginx/sites-enabled/default</code></pre>

<h4 id="add-ssl_params">Add ssl_params<a class="headerlink" href="#add-ssl_params" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF | sudo tee /etc/nginx/ssl_params
# Session settings
ssl_session_timeout 1d;
ssl_session_cache shared:SSL:50m;
ssl_session_tickets off;

# modern configuration. tweak to your needs.
ssl_protocols TLSv1.2;
ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';
ssl_prefer_server_ciphers on;

# HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)
add_header Strict-Transport-Security max-age=15768000;

# OCSP Stapling ---
# fetch OCSP records from URL in ssl_certificate and cache them
ssl_stapling on;
ssl_stapling_verify on;
EOF</code></pre>

<h4 id="general-http-to-https-redirector">General HTTP to HTTPS redirector<a class="headerlink" href="#general-http-to-https-redirector" title="Permanent link">&para;</a></h4>
<p>This nginx entry will rewrite all traffic from HTTP to HTTPS.
<pre class="codehilite"><code class="language-shell">read -r -d '' read_tmp&lt;&lt;&quot;EOF&quot;
server {
\tlisten 80 default_server;
\tlisten [::]:80 default_server;
\tserver_name _;
\treturn 301 https://$host$request_uri;
}
EOF
echo -e &quot;$read_tmp&quot; | sudo tee /etc/nginx/sites-available/99-https-rewrite.conf &amp;&amp; \
sudo ln -s ../sites-available/99-https-rewrite.conf /etc/nginx/sites-enabled/99-https-rewrite.conf</code></pre></p>
<h4 id="portainer">Portainer<a class="headerlink" href="#portainer" title="Permanent link">&para;</a></h4>
<p>Add server directive for Portainer:<br />
<pre class="codehilite"><code class="language-shell">portainer_ip=$(sudo docker inspect -f &quot;{{ .NetworkSettings.Networks.concourse_net.IPAddress }}&quot; portainer); \
cat &lt;&lt; EOF | sed 's/\\t/\t/g' | sudo tee /etc/nginx/sites-available/10-portainer.ci.mischaufen.de.conf &amp;&amp; \
sudo ln -s ../sites-available/10-portainer.ci.mischaufen.de.conf /etc/nginx/sites-enabled/10-portainer.ci.mischaufen.de.conf
server {
\tlisten\t\t443 ssl http2;
\tlisten\t\t[::]:443 ssl http2;
\tserver_name\tportainer.ci.mischaufen.de;

\taccess_log\t/var/log/nginx/portainer.ci.mischaufen.de_access.log combined gzip=9;
\terror_log\t/var/log/nginx/portainer.ci.mischaufen.de_error.log warn;

\tlocation / {
\t\tset \$upstream_endpoint http://$portainer_ip:9000;
\t\tproxy_http_version\t1.1;
\t\tproxy_set_header\tConnection &quot;&quot;;
\t\tproxy_set_header\tHost \$host;
\t\tproxy_set_header\tX-Forwarded-Host \$server_name;
\t\tadd_header\t\tX-Upstream \$upstream_addr;
\t\tproxy_pass\t\t\$upstream_endpoint;
\t}

\tlocation /api/websocket/ {
\t\tset \$upstream_endpoint http://$portainer_ip:9000;
\t\tproxy_buffering\t\toff;
\t\tproxy_set_header\tUpgrade \$http_upgrade;
\t\tproxy_set_header\tConnection &quot;Upgrade&quot;;
\t\tproxy_set_header\tHost \$host;
\t\tproxy_set_header\tX-Forwarded-Server \$host;
\t\tproxy_set_header\tX-Forwarded-For \$proxy_add_x_forwarded_for;
\t\tproxy_set_header\tX-Forwarded-Host \$server_name;
\t\tadd_header\t\tX-Upstream \$upstream_addr;
\t\tproxy_http_version\t1.1;
\t\tproxy_pass\t\t\$upstream_endpoint;
\t\t# Need this for the console
\t\tproxy_redirect\t\thttp://$portainer_ip:9000 \$scheme://\$host/;
\t}

\tinclude\t\t/etc/nginx/ssl_params;

}
EOF</code></pre></p>
<p>Install a Let's encrypt SSL Certificate:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Don't add a redirect to HTTPS.</p>
</div>
<pre class="codehilite"><code class="language-shell">sudo certbot --nginx -d portainer.ci.mischaufen.de &amp;&amp; \
sudo sed -i '/ssl_certificate_key/a \ \ \ \ ssl_trusted_certificate /etc/letsencrypt/live/portainer.ci.mischaufen.de/chain.pem;' /etc/nginx/sites-available/10-portainer.ci.mischaufen.de.conf &amp;&amp; \
sudo systemctl reload nginx.service</code></pre>

<h4 id="concourse_1">Concourse<a class="headerlink" href="#concourse_1" title="Permanent link">&para;</a></h4>
<p>Add server directive for Concourse:<br />
<pre class="codehilite"><code class="language-shell">cat &lt;&lt; EOF | sed 's/\\t/\t/g' | sudo tee /etc/nginx/sites-available/11-ci.mischaufen.de.conf &amp;&amp; \
sudo ln -s ../sites-available/11-ci.mischaufen.de.conf /etc/nginx/sites-enabled/11-ci.mischaufen.de.conf
upstream concourse {
\tserver\t\t$(sudo docker inspect -f &quot;{{ .NetworkSettings.Networks.concourse_net.IPAddress }}&quot; concourse-web):8080;
}

server {
\tlisten\t\t443 ssl http2;
\tlisten\t\t[::]:443 ssl http2;
\tserver_name\tci.mischaufen.de;

\taccess_log\t/var/log/nginx/ci.mischaufen.de_access.log combined gzip=9;
\terror_log\t/var/log/nginx/ci.mischaufen.de_error.log warn;

\tlocation / {
\t\tinclude\t\t\tproxy_params;
\t\tproxy_http_version\t1.1;
\t\tproxy_read_timeout\t90;

\t\tproxy_set_header\tUpgrade \$http_upgrade;
\t\tproxy_set_header\tConnection &quot;upgrade&quot;;

\t\tproxy_pass\t\thttp://concourse;
\t}

\tinclude\t\t/etc/nginx/ssl_params;

}
EOF</code></pre></p>
<p>Check if config is ok:<br />
<pre class="codehilite"><code class="language-shell">sudo nginx -t</code></pre></p>
<p>Install a Let's encrypt SSL Certificate:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Don't add a redirect to HTTPS.</p>
</div>
<pre class="codehilite"><code class="language-shell">sudo certbot --nginx -d ci.mischaufen.de &amp;&amp; \
sudo sed -i '/ssl_certificate_key/a \ \ \ \ ssl_trusted_certificate /etc/letsencrypt/live/ci.mischaufen.de/chain.pem;' /etc/nginx/sites-available/11-ci.mischaufen.de.conf &amp;&amp; \
sudo systemctl reload nginx.service</code></pre>

<h3 id="add-cronjob-for-renewing-cetificates">Add cronjob for renewing cetificates<a class="headerlink" href="#add-cronjob-for-renewing-cetificates" title="Permanent link">&para;</a></h3>
<p><code>sudo crontab -e</code>:<br />
<pre class="codehilite"><code>0 */12 * * * /usr/local/bin/certbot renew</code></pre></p>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<h3 id="iptables">iptables<a class="headerlink" href="#iptables" title="Permanent link">&para;</a></h3>
<details class="tip"><summary>Explanation iptables rules</summary><pre class="codehilite"><code class="language-shell"># Allow loopback
iptables -A OUTPUT -o lo -j ACCEPT
iptables -A INPUT -i lo -j ACCEPT

# Allow SSH incoming
iptables -t filter -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT

# Allow web interface SeedBox incoming
iptables -t filter -A INPUT -i eth0 -p tcp -m multiport --dports 80,443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT

# Policy DROP INPUT on `eth0`
iptables -t filter -A INPUT -i eth0 -j DROP;

# Allow output on `eth0`
iptables -t filter -A OUTPUT -o eth0 -j ACCEPT</code></pre>

</details>
<p>Set up needed iptables rules:<br />
<pre class="codehilite"><code class="language-shell">sudo iptables -A OUTPUT -o lo -j ACCEPT; \
sudo iptables -A INPUT -i lo -j ACCEPT; \
sudo iptables -t filter -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT; \
sudo iptables -t filter -A INPUT -i eth0 -p tcp -m multiport --dports 80,443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT; \
sudo iptables -t filter -A INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT; \
sudo iptables -t filter -A INPUT -i eth0 -p icmp -j ACCEPT; \
sudo iptables -t filter -A INPUT -i eth0 -j DROP; \
sudo iptables -t filter -A OUTPUT -o eth0 -j ACCEPT</code></pre>
Set up needed ip6tables rules:<br />
<pre class="codehilite"><code class="language-shell">sudo ip6tables -A OUTPUT -o lo -j ACCEPT; \
sudo ip6tables -A INPUT -i lo -j ACCEPT; \
sudo ip6tables -t filter -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT; \
sudo ip6tables -t filter -A INPUT -i eth0 -p tcp -m multiport --dports 80,443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT; \
sudo ip6tables -t filter -A INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT; \
sudo ip6tables -t filter -A INPUT -i eth0 -p ipv6-icmp -j ACCEPT; \
sudo ip6tables -t filter -A INPUT -i eth0 -j DROP; \
sudo ip6tables -t filter -A OUTPUT -o eth0 -j ACCEPT</code></pre></p>
<p>Persist iptables rules:<br />
<pre class="codehilite"><code class="language-shell">sudo apt install -y iptables-persistent &amp;&amp; \
sudo netfilter-persistent save &amp;&amp; \
sudo netfilter-persistent reload</code></pre></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="http://pphg.tech" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://keybase.io/philip_henning" class="md-footer-social__link fa fa-key"></a>
    
      <a href="https://twitter.com/__phg" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://github.com/shokinn" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://gitlab.com/shokinn" class="md-footer-social__link fa fa-gitlab"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../search/main.js"></script>
      
    
    
      
    
  </body>
</html>